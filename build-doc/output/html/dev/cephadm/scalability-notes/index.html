
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Notes and Thoughts on Cephadm’s scalability &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Ceph Storage Cluster" href="../../../rados/" />
    <link rel="prev" title="cephadm Exporter" href="../cephadm-exporter/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../rados/" title="Ceph Storage Cluster"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../cephadm-exporter/" title="cephadm Exporter"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../cephadm/" >Cephadm</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../" accesskey="U">CEPHADM Developer Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Notes and Thoughts on Cephadm’s scalability</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="notes-and-thoughts-on-cephadm-s-scalability">
<h1>Notes and Thoughts on Cephadm’s scalability<a class="headerlink" href="#notes-and-thoughts-on-cephadm-s-scalability" title="Permalink to this heading">¶</a></h1>
<section id="about-this-document">
<h2>About this document<a class="headerlink" href="#about-this-document" title="Permalink to this heading">¶</a></h2>
<p>This document does NOT define a specific proposal or some future work.
Instead it merely lists a few thoughts that MIGHT be relevant for future
cephadm enhacements.</p>
</section>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this heading">¶</a></h2>
<p>Current situation:</p>
<p>Cephadm manages all registered hosts. This means that it periodically
scrapes data from each host to identify changes on the host like:</p>
<ul class="simple">
<li><p>disk added/removed</p></li>
<li><p>daemon added/removed</p></li>
<li><p>host network/firewall etc has changed</p></li>
</ul>
<p>Currently, cephadm scrapes each host (up to 10 in parallel) every 6
minutes, unless a refresh is forced manually.</p>
<p>Refreshes for disks (ceph-volume), daemons (podman/docker), etc, happen
in sequence.</p>
<p>With the cephadm exporter, we have now reduced the time to scan hosts
considerably, but the question remains:</p>
<p>Is the cephadm-exporter sufficient to solve all future scalability
issues?</p>
</section>
<section id="considerations-of-cephadm-exporter-s-rest-api">
<h2>Considerations of cephadm-exporter’s REST API<a class="headerlink" href="#considerations-of-cephadm-exporter-s-rest-api" title="Permalink to this heading">¶</a></h2>
<p>The cephadm-exporter uses HTTP to serve an endpoint to the hosts
metadata. We MIGHT encounter some issues with this approach, which need
to be mitigated at some point.</p>
<ul class="simple">
<li><p>With the cephadm-exporter we use SSH and HTTP to connect to each
host. Having two distinct transport layers feels odd, and we might
want to consider reducing it to only a single protocol.</p></li>
<li><p>The current approach of delivering <code class="docutils literal notranslate"><span class="pre">bin/cephadm</span></code> to the host doesn’t
allow the use of external dependencies. This means that we’re stuck
with the built-in HTTP server lib, which isn’t great for providing a
good developer experience. <code class="docutils literal notranslate"><span class="pre">bin/cephadm</span></code> needs to be packaged and
distributed (one way or the other) for us to make use of a better
http server library.</p></li>
</ul>
</section>
<section id="mon-s-config-key-store">
<h2>MON’s config-key store<a class="headerlink" href="#mon-s-config-key-store" title="Permalink to this heading">¶</a></h2>
<p>After the <code class="docutils literal notranslate"><span class="pre">mgr/cephadm</span></code> queried metadata from each host, cephadm stores
the data within the mon’s k-v store.</p>
<p>If each host would be allowed to write their own metadata to the store,
<code class="docutils literal notranslate"><span class="pre">mgr/cephadm</span></code> would no longer be required to gather the data.</p>
<p>Some questions arise:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mgr/cephadm</span></code> now needs to query data from the config-key store,
instead of relying on cached data.</p></li>
<li><p>cephadm knows three different types of data: (1) Data that is
critical and needs to be stored in the config-key store. (2) Data
that can be kept in memory only. (3) Data that can be stored in
RADOS pool. How can we apply this idea to those different types of
data.</p></li>
</ul>
</section>
<section id="increase-the-worker-pool-size">
<h2>Increase the worker pool size<a class="headerlink" href="#increase-the-worker-pool-size" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">mgr/cephadm</span></code> is currently able to scrape 10 nodes at the same time.</p>
<p>The scrape of a individual host takes the same amount of time persists.
We’d just reduce the overall execution time.</p>
<p>At best we can reach O(hosts) + O(daemons).</p>
</section>
<section id="backwards-compatibility">
<h2>Backwards compatibility<a class="headerlink" href="#backwards-compatibility" title="Permalink to this heading">¶</a></h2>
<p>Any changes need to be backwards compatible or completely isolated from
any existing functionality. There are running cephadm clusters out there
that require an upgrade path.</p>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installing Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../developer_guide/">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/intro/">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/essentials/">Essentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/merging/">What is Merged and When</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/issue-tracker/">Issue tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/basic-workflow/">Basic workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/tests-unit-tests/">Tests: Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/tests-integration-tests/">Tests: Integration Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/running-tests-locally/">Running Tests Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/running-tests-using-teuth/">Running Integration Tests using Teuthology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/running-tests-in-cloud/">Running Tests in the Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/dash-devel/">Ceph Dashboard Developer Documentation (formerly HACKING.rst)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">cephadm Developer Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../developing-cephadm/">Developing with cephadm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../host-maintenance/">Host Maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../compliance-check/">Compliance Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephadm-exporter/">cephadm Exporter</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Notes and Thoughts on Cephadm’s scalability</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#about-this-document">About this document</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intro">Intro</a></li>
<li class="toctree-l4"><a class="reference internal" href="#considerations-of-cephadm-exporter-s-rest-api">Considerations of cephadm-exporter’s REST API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mon-s-config-key-store">MON’s config-key store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#increase-the-worker-pool-size">Increase the worker pool size</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backwards-compatibility">Backwards compatibility</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../rados/" title="Ceph Storage Cluster"
             >next</a> |</li>
        <li class="right" >
          <a href="../cephadm-exporter/" title="cephadm Exporter"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../cephadm/" >Cephadm</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../" >CEPHADM Developer Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Notes and Thoughts on Cephadm’s scalability</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>