
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Troubleshooting &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="CEPHADM Developer Documentation" href="../../dev/cephadm/" />
    <link rel="prev" title="Basic Ceph Client Setup" href="../client-setup/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../dev/cephadm/" title="CEPHADM Developer Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../client-setup/" title="Basic Ceph Client Setup"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Cephadm</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Troubleshooting</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h1>
<p>You may wish to investigate why a cephadm command failed
or why a certain service no longer runs properly.</p>
<p>Cephadm deploys daemons within containers. This means that
troubleshooting those containerized daemons will require
a different process than traditional package-install daemons.</p>
<p>Here are some tools and commands to help you troubleshoot
your Ceph environment.</p>
<section id="pausing-or-disabling-cephadm">
<span id="cephadm-pause"></span><h2>Pausing or Disabling cephadm<a class="headerlink" href="#pausing-or-disabling-cephadm" title="Permalink to this heading">¶</a></h2>
<p>If something goes wrong and cephadm is behaving badly, you can
pause most of the Ceph cluster’s background activity by running
the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "# ";
}
</style><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>pause</span>
</pre></div></div><p>This stops all changes in the Ceph cluster, but cephadm will
still periodically check hosts to refresh its inventory of
daemons and devices.  You can disable cephadm completely by
running the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span><span class="nb">set</span><span class="w"> </span>backend<span class="w"> </span><span class="s1">&#39;&#39;</span></span>
<span class="prompt1">ceph<span class="w"> </span>mgr<span class="w"> </span>module<span class="w"> </span>disable<span class="w"> </span>cephadm</span>
</pre></div></div><p>These commands disable all of the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">orch</span> <span class="pre">...</span></code> CLI commands.
All previously deployed daemon containers continue to exist and
will start as they did before you ran these commands.</p>
<p>See <a class="reference internal" href="../services/#cephadm-spec-unmanaged"><span class="std std-ref">Disabling automatic deployment of daemons</span></a> for information on disabling
individual services.</p>
</section>
<section id="per-service-and-per-daemon-events">
<h2>Per-service and Per-daemon Events<a class="headerlink" href="#per-service-and-per-daemon-events" title="Permalink to this heading">¶</a></h2>
<p>In order to facilitate debugging failed daemons,
cephadm stores events per service and per daemon.
These events often contain information relevant to
troubleshooting your Ceph cluster.</p>
<section id="listing-service-events">
<h3>Listing Service Events<a class="headerlink" href="#listing-service-events" title="Permalink to this heading">¶</a></h3>
<p>To see the events associated with a certain service, run a
command of the and following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>ls<span class="w"> </span>--service_name<span class="o">=</span>&lt;service-name&gt;<span class="w"> </span>--format<span class="w"> </span>yaml</span>
</pre></div></div><p>This will return something in the following form:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager</span>
<span class="nt">service_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager</span>
<span class="nt">placement</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unknown_host</span>
<span class="nt">status</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">running</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">events</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2021-02-01T08:58:02.741162 service:alertmanager [INFO] &quot;service was created&quot;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;2021-02-01T12:09:25.264584</span><span class="nv"> </span><span class="s">service:alertmanager</span><span class="nv"> </span><span class="s">[ERROR]</span><span class="nv"> </span><span class="s">&quot;Failed</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">apply:</span><span class="nv"> </span><span class="s">Cannot</span>
<span class="w">  </span><span class="s">place</span><span class="nv"> </span><span class="s">&lt;AlertManagerSpec</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">service_name=alertmanager&gt;</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">unknown_host:</span><span class="nv"> </span><span class="s">Unknown</span><span class="nv"> </span><span class="s">hosts&quot;&#39;</span>
</pre></div>
</div>
</section>
<section id="listing-daemon-events">
<h3>Listing Daemon Events<a class="headerlink" href="#listing-daemon-events" title="Permalink to this heading">¶</a></h3>
<p>To see the events associated with a certain daemon, run a
command of the and following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>ps<span class="w"> </span>--service-name<span class="w"> </span>&lt;service-name&gt;<span class="w"> </span>--daemon-id<span class="w"> </span>&lt;daemon-id&gt;<span class="w"> </span>--format<span class="w"> </span>yaml</span>
</pre></div></div><p>This will return something in the following form:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">daemon_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mds</span>
<span class="nt">daemon_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cephfs.hostname.ppdhsz</span>
<span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostname</span>
<span class="nt">status_desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">running</span>
<span class="nn">...</span>
<span class="nt">events</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2021-02-01T08:59:43.845866 daemon:mds.cephfs.hostname.ppdhsz [INFO] &quot;Reconfigured</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">mds.cephfs.hostname.ppdhsz on host &#39;hostname&#39;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="checking-cephadm-logs">
<h2>Checking Cephadm Logs<a class="headerlink" href="#checking-cephadm-logs" title="Permalink to this heading">¶</a></h2>
<p>To learn how to monitor cephadm logs as they are generated, read <a class="reference internal" href="../operations/#watching-cephadm-logs"><span class="std std-ref">Watching cephadm log messages</span></a>.</p>
<p>If your Ceph cluster has been configured to log events to files, there will be a
<code class="docutils literal notranslate"><span class="pre">ceph.cephadm.log</span></code> file on all monitor hosts (see
<a class="reference internal" href="../operations/#cephadm-logs"><span class="std std-ref">Ceph daemon logs</span></a> for a more complete explanation).</p>
</section>
<section id="gathering-log-files">
<h2>Gathering Log Files<a class="headerlink" href="#gathering-log-files" title="Permalink to this heading">¶</a></h2>
<p>Use journalctl to gather the log files of all daemons:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default cephadm now stores logs in journald. This means
that you will no longer find daemon logs in <code class="docutils literal notranslate"><span class="pre">/var/log/ceph/</span></code>.</p>
</div>
<p>To read the log file of one specific daemon, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cephadm</span> <span class="n">logs</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">daemon</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note: this only works when run on the same host where the daemon is running. To
get logs of a daemon running on a different host, give the <code class="docutils literal notranslate"><span class="pre">--fsid</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cephadm</span> <span class="n">logs</span> <span class="o">--</span><span class="n">fsid</span> <span class="o">&lt;</span><span class="n">fsid</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">daemon</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">&lt;fsid&gt;</span></code> corresponds to the cluster ID printed by <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">status</span></code>.</p>
<p>To fetch all log files of all daemons on a given host, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for name in $(cephadm ls | jq -r &#39;.[].name&#39;) ; do
  cephadm logs --fsid &lt;fsid&gt; --name &quot;$name&quot; &gt; $name;
done
</pre></div>
</div>
</section>
<section id="collecting-systemd-status">
<h2>Collecting Systemd Status<a class="headerlink" href="#collecting-systemd-status" title="Permalink to this heading">¶</a></h2>
<p>To print the state of a systemd unit, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">status</span> <span class="s2">&quot;ceph-$(cephadm shell ceph fsid)@&lt;service name&gt;.service&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>To fetch all state of all daemons of a given host, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fsid=&quot;$(cephadm shell ceph fsid)&quot;
for name in $(cephadm ls | jq -r &#39;.[].name&#39;) ; do
  systemctl status &quot;ceph-$fsid@$name.service&quot; &gt; $name;
done
</pre></div>
</div>
</section>
<section id="list-all-downloaded-container-images">
<h2>List all Downloaded Container Images<a class="headerlink" href="#list-all-downloaded-container-images" title="Permalink to this heading">¶</a></h2>
<p>To list all container images that are downloaded on a host:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Image</span></code> might also be called <cite>ImageID</cite></p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">podman</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span> <span class="o">--</span><span class="nb">format</span> <span class="n">json</span> <span class="o">|</span> <span class="n">jq</span> <span class="s1">&#39;.[].Image&#39;</span>
<span class="s2">&quot;docker.io/library/centos:8&quot;</span>
<span class="s2">&quot;registry.opensuse.org/opensuse/leap:15.2&quot;</span>
</pre></div>
</div>
</section>
<section id="manually-running-containers">
<h2>Manually Running Containers<a class="headerlink" href="#manually-running-containers" title="Permalink to this heading">¶</a></h2>
<p>Cephadm uses small wrappers when running containers. Refer to
<code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/&lt;cluster-fsid&gt;/&lt;service-name&gt;/unit.run</span></code> for the
container execution command.</p>
</section>
<section id="ssh-errors">
<span id="cephadm-ssh-errors"></span><h2>SSH Errors<a class="headerlink" href="#ssh-errors" title="Permalink to this heading">¶</a></h2>
<p>Error message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execnet</span><span class="o">.</span><span class="n">gateway_bootstrap</span><span class="o">.</span><span class="n">HostNotFound</span><span class="p">:</span> <span class="o">-</span><span class="n">F</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cephadm</span><span class="o">-</span><span class="n">conf</span><span class="o">-</span><span class="mi">73</span><span class="n">z09u6g</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cephadm</span><span class="o">-</span><span class="n">identity</span><span class="o">-</span><span class="n">ky7ahp_5</span> <span class="n">root</span><span class="o">@</span><span class="mf">10.10.1.2</span>
<span class="o">...</span>
<span class="k">raise</span> <span class="n">OrchestratorError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span class="n">orchestrator</span><span class="o">.</span><span class="n">_interface</span><span class="o">.</span><span class="n">OrchestratorError</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">connect</span> <span class="n">to</span> <span class="mf">10.10.1.2</span> <span class="p">(</span><span class="mf">10.10.1.2</span><span class="p">)</span><span class="o">.</span>
<span class="n">Please</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">host</span> <span class="ow">is</span> <span class="n">reachable</span> <span class="ow">and</span> <span class="n">accepts</span> <span class="n">connections</span> <span class="n">using</span> <span class="n">the</span> <span class="n">cephadm</span> <span class="n">SSH</span> <span class="n">key</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Things Ceph administrators can do:</p>
<ol class="arabic">
<li><p>Ensure cephadm has an SSH identity key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span><span class="o">~</span><span class="p">]</span><span class="c1"># cephadm shell -- ceph config-key get mgr/cephadm/ssh_identity_key &gt; ~/cephadm_private_key</span>
<span class="n">INFO</span><span class="p">:</span><span class="n">cephadm</span><span class="p">:</span><span class="n">Inferring</span> <span class="n">fsid</span> <span class="n">f8edc08a</span><span class="o">-</span><span class="mi">7</span><span class="n">f17</span><span class="o">-</span><span class="mi">11</span><span class="n">ea</span><span class="o">-</span><span class="mi">8707</span><span class="o">-</span><span class="mi">000</span><span class="n">c2915dd98</span>
<span class="n">INFO</span><span class="p">:</span><span class="n">cephadm</span><span class="p">:</span><span class="n">Using</span> <span class="n">recent</span> <span class="n">ceph</span> <span class="n">image</span> <span class="n">docker</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">ceph</span><span class="p">:</span><span class="n">v15</span> <span class="n">obtained</span> <span class="s1">&#39;mgr/cephadm/ssh_identity_key&#39;</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span> <span class="c1"># chmod 0600 ~/cephadm_private_key</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>If this fails, cephadm doesn’t have a key. Fix this by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cephadm shell -- ceph cephadm generate-ssh-key</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat ~/cephadm_private_key | cephadm shell -- ceph cephadm set-ssk-key -i -</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>Ensure that the SSH config is correct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cephadm shell -- ceph cephadm get-ssh-config &gt; config</span>
</pre></div>
</div>
</li>
<li><p>Verify that we can connect to the host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ssh -F config -i ~/cephadm_private_key root@mon1</span>
</pre></div>
</div>
</li>
</ol>
<section id="verifying-that-the-public-key-is-listed-in-the-authorized-keys-file">
<h3>Verifying that the Public Key is Listed in the authorized_keys file<a class="headerlink" href="#verifying-that-the-public-key-is-listed-in-the-authorized-keys-file" title="Permalink to this heading">¶</a></h3>
<p>To verify that the public key is in the authorized_keys file, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cephadm shell -- ceph cephadm get-pub-key &gt; ~/ceph.pub</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># grep &quot;`cat ~/ceph.pub`&quot;  /root/.ssh/authorized_keys</span>
</pre></div>
</div>
</section>
</section>
<section id="failed-to-infer-cidr-network-error">
<h2>Failed to Infer CIDR network error<a class="headerlink" href="#failed-to-infer-cidr-network-error" title="Permalink to this heading">¶</a></h2>
<p>If you see this error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERROR</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">infer</span> <span class="n">CIDR</span> <span class="n">network</span> <span class="k">for</span> <span class="n">mon</span> <span class="n">ip</span> <span class="o">***</span><span class="p">;</span> <span class="k">pass</span> <span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">mon</span><span class="o">-</span><span class="n">network</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">it</span> <span class="n">later</span>
</pre></div>
</div>
<p>Or this error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Must</span> <span class="nb">set</span> <span class="n">public_network</span> <span class="n">config</span> <span class="n">option</span> <span class="ow">or</span> <span class="n">specify</span> <span class="n">a</span> <span class="n">CIDR</span> <span class="n">network</span><span class="p">,</span> <span class="n">ceph</span> <span class="n">addrvec</span><span class="p">,</span> <span class="ow">or</span> <span class="n">plain</span> <span class="n">IP</span>
</pre></div>
</div>
<p>This means that you must run a command of this form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">config</span> <span class="nb">set</span> <span class="n">mon</span> <span class="n">public_network</span> <span class="o">&lt;</span><span class="n">mon_network</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For more detail on operations of this kind, see <a class="reference internal" href="../services/mon/#deploy-additional-monitors"><span class="std std-ref">Deploying additional monitors</span></a></p>
</section>
<section id="accessing-the-admin-socket">
<h2>Accessing the Admin Socket<a class="headerlink" href="#accessing-the-admin-socket" title="Permalink to this heading">¶</a></h2>
<p>Each Ceph daemon provides an admin socket that bypasses the
MONs (See <a class="reference internal" href="../../rados/operations/monitoring/#rados-monitoring-using-admin-socket"><span class="std std-ref">Using the Admin Socket</span></a>).</p>
<p>To access the admin socket, first enter the daemon container on the host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@mon1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cephadm enter --name &lt;daemon-name&gt;</span>
<span class="p">[</span><span class="n">ceph</span><span class="p">:</span> <span class="n">root</span><span class="nd">@mon1</span> <span class="o">/</span><span class="p">]</span><span class="c1"># ceph --admin-daemon /var/run/ceph/ceph-&lt;daemon-name&gt;.asok config show</span>
</pre></div>
</div>
</section>
<section id="running-various-ceph-tools">
<h2>Running Various Ceph Tools<a class="headerlink" href="#running-various-ceph-tools" title="Permalink to this heading">¶</a></h2>
<p>To run Ceph tools like <code class="docutils literal notranslate"><span class="pre">ceph-objectstore-tool</span></code> or
<code class="docutils literal notranslate"><span class="pre">ceph-monstore-tool</span></code>, invoke the cephadm CLI with
<code class="docutils literal notranslate"><span class="pre">cephadm</span> <span class="pre">shell</span> <span class="pre">--name</span> <span class="pre">&lt;daemon-name&gt;</span></code>.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@myhostname</span> <span class="c1"># cephadm unit --name mon.myhostname stop</span>
<span class="n">root</span><span class="nd">@myhostname</span> <span class="c1"># cephadm shell --name mon.myhostname</span>
<span class="p">[</span><span class="n">ceph</span><span class="p">:</span> <span class="n">root</span><span class="nd">@myhostname</span> <span class="o">/</span><span class="p">]</span><span class="c1"># ceph-monstore-tool /var/lib/ceph/mon/ceph-myhostname get monmap &gt; monmap</span>
<span class="p">[</span><span class="n">ceph</span><span class="p">:</span> <span class="n">root</span><span class="nd">@myhostname</span> <span class="o">/</span><span class="p">]</span><span class="c1"># monmaptool --print monmap</span>
<span class="n">monmaptool</span><span class="p">:</span> <span class="n">monmap</span> <span class="n">file</span> <span class="n">monmap</span>
<span class="n">epoch</span> <span class="mi">1</span>
<span class="n">fsid</span> <span class="mi">28596</span><span class="n">f44</span><span class="o">-</span><span class="mi">3</span><span class="n">b56</span><span class="o">-</span><span class="mi">11</span><span class="n">ec</span><span class="o">-</span><span class="mi">9034</span><span class="o">-</span><span class="mi">482</span><span class="n">ae35a5fbb</span>
<span class="n">last_changed</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span><span class="n">T20</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mf">19.755111</span><span class="o">+</span><span class="mi">0000</span>
<span class="n">created</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span><span class="n">T20</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mf">19.755111</span><span class="o">+</span><span class="mi">0000</span>
<span class="n">min_mon_release</span> <span class="mi">17</span> <span class="p">(</span><span class="n">quincy</span><span class="p">)</span>
<span class="n">election_strategy</span><span class="p">:</span> <span class="mi">1</span>
<span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="n">v2</span><span class="p">:</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">3300</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">:</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">6789</span><span class="o">/</span><span class="mi">0</span><span class="p">]</span> <span class="n">mon</span><span class="o">.</span><span class="n">myhostname</span>
</pre></div>
</div>
<p>The cephadm shell sets up the environment in a way that is suitable
for extended daemon maintenance and running daemons interactively.</p>
</section>
<section id="restoring-the-monitor-quorum">
<span id="cephadm-restore-quorum"></span><h2>Restoring the Monitor Quorum<a class="headerlink" href="#restoring-the-monitor-quorum" title="Permalink to this heading">¶</a></h2>
<p>If the Ceph monitor daemons (mons) cannot form a quorum, cephadm will not be
able to manage the cluster until quorum is restored.</p>
<p>In order to restore the quorum, remove unhealthy monitors
form the monmap by following these steps:</p>
<ol class="arabic">
<li><p>Stop all mons. For each mon host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh {mon-host}
cephadm unit --name mon.`hostname` stop
</pre></div>
</div>
</li>
<li><p>Identify a surviving monitor and log in to that host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh {mon-host}
cephadm enter --name mon.`hostname`
</pre></div>
</div>
</li>
<li><p>Follow the steps in <a class="reference internal" href="../../rados/operations/add-or-rm-mons/#rados-mon-remove-from-unhealthy"><span class="std std-ref">Removing Monitors from an Unhealthy Cluster</span></a></p></li>
</ol>
</section>
<section id="manually-deploying-a-manager-daemon">
<span id="cephadm-manually-deploy-mgr"></span><h2>Manually Deploying a Manager Daemon<a class="headerlink" href="#manually-deploying-a-manager-daemon" title="Permalink to this heading">¶</a></h2>
<p>At least one manager (mgr) daemon is required by cephadm in order to manage the
cluster. If the last mgr in a cluster has been removed, follow these steps in
order to deploy a manager called (for example)
<code class="docutils literal notranslate"><span class="pre">mgr.hostname.smfvfd</span></code> on a random host of your cluster manually.</p>
<p>Disable the cephadm scheduler, in order to prevent cephadm from removing the new
manager. See <a class="reference internal" href="../install/#cephadm-enable-cli"><span class="std std-ref">Enable Ceph CLI</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">config</span><span class="o">-</span><span class="n">key</span> <span class="nb">set</span> <span class="n">mgr</span><span class="o">/</span><span class="n">cephadm</span><span class="o">/</span><span class="n">pause</span> <span class="n">true</span>
</pre></div>
</div>
<p>Then get or create the auth entry for the new manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">auth</span> <span class="n">get</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">create</span> <span class="n">mgr</span><span class="o">.</span><span class="n">hostname</span><span class="o">.</span><span class="n">smfvfd</span> <span class="n">mon</span> <span class="s2">&quot;profile mgr&quot;</span> <span class="n">osd</span> <span class="s2">&quot;allow *&quot;</span> <span class="n">mds</span> <span class="s2">&quot;allow *&quot;</span>
</pre></div>
</div>
<p>Get the ceph.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">config</span> <span class="n">generate</span><span class="o">-</span><span class="n">minimal</span><span class="o">-</span><span class="n">conf</span>
</pre></div>
</div>
<p>Get the container image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">config</span> <span class="n">get</span> <span class="s2">&quot;mgr.hostname.smfvfd&quot;</span> <span class="n">container_image</span>
</pre></div>
</div>
<p>Create a file <code class="docutils literal notranslate"><span class="pre">config-json.json</span></code> which contains the information neccessary to deploy
the daemon:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;config&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;# minimal ceph.conf for 8255263a-a97e-4934-822c-00bfe029b28f\n[global]\n\tfsid = 8255263a-a97e-4934-822c-00bfe029b28f\n\tmon_host = [v2:192.168.0.1:40483/0,v1:192.168.0.1:40484/0]\n&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;keyring&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;[mgr.hostname.smfvfd]\n\tkey = V2VyIGRhcyBsaWVzdCBpc3QgZG9vZi4=\n&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Deploy the daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cephadm</span> <span class="o">--</span><span class="n">image</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">-</span><span class="n">image</span><span class="o">&gt;</span> <span class="n">deploy</span> <span class="o">--</span><span class="n">fsid</span> <span class="o">&lt;</span><span class="n">fsid</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">name</span> <span class="n">mgr</span><span class="o">.</span><span class="n">hostname</span><span class="o">.</span><span class="n">smfvfd</span> <span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="n">json</span> <span class="n">config</span><span class="o">-</span><span class="n">json</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</section>
<section id="analyzing-core-dumps">
<h2>Analyzing Core Dumps<a class="headerlink" href="#analyzing-core-dumps" title="Permalink to this heading">¶</a></h2>
<p>When a Ceph daemon crashes, cephadm supports analyzing core dumps. To enable core dumps, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nb">ulimit</span><span class="w"> </span>-c<span class="w"> </span>unlimited</span>
</pre></div></div><p>Core dumps will now be written to <code class="docutils literal notranslate"><span class="pre">/var/lib/systemd/coredump</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Core dumps are not namespaced by the kernel, which means
they will be written to <code class="docutils literal notranslate"><span class="pre">/var/lib/systemd/coredump</span></code> on
the container host.</p>
</div>
<p>Now, wait for the crash to happen again. To simulate the crash of a daemon, run e.g. <code class="docutils literal notranslate"><span class="pre">killall</span> <span class="pre">-3</span> <span class="pre">ceph-mon</span></code>.</p>
<p>Install debug packages including <code class="docutils literal notranslate"><span class="pre">ceph-debuginfo</span></code> by entering the cephadm shelll:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cephadm shell --mount /var/lib/systemd/coredump</span>
<span class="p">[</span><span class="n">ceph</span><span class="p">:</span> <span class="n">root</span><span class="nd">@host1</span> <span class="o">/</span><span class="p">]</span><span class="c1"># dnf install ceph-debuginfo gdb zstd</span>
<span class="p">[</span><span class="n">ceph</span><span class="p">:</span> <span class="n">root</span><span class="nd">@host1</span> <span class="o">/</span><span class="p">]</span><span class="c1"># unzstd /mnt/coredump/core.ceph-*.zst</span>
<span class="p">[</span><span class="n">ceph</span><span class="p">:</span> <span class="n">root</span><span class="nd">@host1</span> <span class="o">/</span><span class="p">]</span><span class="c1"># gdb /usr/bin/ceph-mon /mnt/coredump/core.ceph-...</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">bt</span>
<span class="c1">#0  0x00007fa9117383fc in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span>
<span class="c1">#1  0x00007fa910d7f8f0 in std::condition_variable::wait(std::unique_lock&lt;std::mutex&gt;&amp;) () from /lib64/libstdc++.so.6</span>
<span class="c1">#2  0x00007fa913d3f48f in AsyncMessenger::wait() () from /usr/lib64/ceph/libceph-common.so.2</span>
<span class="c1">#3  0x0000563085ca3d7e in main ()</span>
</pre></div>
</div>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing Ceph</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Cephadm</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../compatibility/">Compatibility and Stability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/">Deploying a new Ceph cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adoption/">Converting an existing cluster to cephadm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../host-management/">Host Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/">Service Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/">Upgrading Ceph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operations/">Cephadm operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client-setup/">Client Setup</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pausing-or-disabling-cephadm">Pausing or Disabling cephadm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#per-service-and-per-daemon-events">Per-service and Per-daemon Events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#listing-service-events">Listing Service Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listing-daemon-events">Listing Daemon Events</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#checking-cephadm-logs">Checking Cephadm Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gathering-log-files">Gathering Log Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#collecting-systemd-status">Collecting Systemd Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list-all-downloaded-container-images">List all Downloaded Container Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manually-running-containers">Manually Running Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ssh-errors">SSH Errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#verifying-that-the-public-key-is-listed-in-the-authorized-keys-file">Verifying that the Public Key is Listed in the authorized_keys file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#failed-to-infer-cidr-network-error">Failed to Infer CIDR network error</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-admin-socket">Accessing the Admin Socket</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-various-ceph-tools">Running Various Ceph Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restoring-the-monitor-quorum">Restoring the Monitor Quorum</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manually-deploying-a-manager-daemon">Manually Deploying a Manager Daemon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyzing-core-dumps">Analyzing Core Dumps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/cephadm/">Cephadm Feature Planning</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../rados/configuration/">Configuration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Deployment</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../compatibility/">Compatibility and Stability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install/">Deploying a new Ceph cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adoption/">Converting an existing cluster to cephadm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../host-management/">Host Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/">Service Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/">Upgrading Ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operations/">Cephadm operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client-setup/">Client Setup</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pausing-or-disabling-cephadm">Pausing or Disabling cephadm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#per-service-and-per-daemon-events">Per-service and Per-daemon Events</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#listing-service-events">Listing Service Events</a></li>
<li class="toctree-l5"><a class="reference internal" href="#listing-daemon-events">Listing Daemon Events</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#checking-cephadm-logs">Checking Cephadm Logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gathering-log-files">Gathering Log Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#collecting-systemd-status">Collecting Systemd Status</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-all-downloaded-container-images">List all Downloaded Container Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manually-running-containers">Manually Running Containers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssh-errors">SSH Errors</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#verifying-that-the-public-key-is-listed-in-the-authorized-keys-file">Verifying that the Public Key is Listed in the authorized_keys file</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#failed-to-infer-cidr-network-error">Failed to Infer CIDR network error</a></li>
<li class="toctree-l4"><a class="reference internal" href="#accessing-the-admin-socket">Accessing the Admin Socket</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-various-ceph-tools">Running Various Ceph Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restoring-the-monitor-quorum">Restoring the Monitor Quorum</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manually-deploying-a-manager-daemon">Manually Deploying a Manager Daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analyzing-core-dumps">Analyzing Core Dumps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev/cephadm/">Cephadm Feature Planning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../rados/operations/">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rados/man/">Man Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rados/troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rados/api/">APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../dev/cephadm/" title="CEPHADM Developer Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="../client-setup/" title="Basic Ceph Client Setup"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Cephadm</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Troubleshooting</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>