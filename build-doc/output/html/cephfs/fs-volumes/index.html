
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>FS volumes and subvolumes &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Quotas" href="../quota/" />
    <link rel="prev" title="Application best practices for distributed file systems" href="../app-best-practices/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../quota/" title="Quotas"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../app-best-practices/" title="Application best practices for distributed file systems"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph File System</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">FS volumes and subvolumes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="fs-volumes-and-subvolumes">
<span id="id1"></span><h1>FS volumes and subvolumes<a class="headerlink" href="#fs-volumes-and-subvolumes" title="Permalink to this heading">¶</a></h1>
<p>The volumes module of the <a class="reference internal" href="../../glossary/#term-Ceph-Manager"><span class="xref std std-term">Ceph Manager</span></a> daemon (ceph-mgr) provides a
single source of truth for CephFS exports. The OpenStack shared file system
service (<a class="reference external" href="https://github.com/openstack/manila">manila</a>) and the Ceph Container Storage Interface (<a class="reference external" href="https://github.com/ceph/ceph-csi">CSI</a>) storage
administrators use the common CLI provided by the ceph-mgr <code class="docutils literal notranslate"><span class="pre">volumes</span></code> module
to manage CephFS exports.</p>
<p>The ceph-mgr <code class="docutils literal notranslate"><span class="pre">volumes</span></code> module implements the following file system export
abstractions:</p>
<ul class="simple">
<li><p>FS volumes, an abstraction for CephFS file systems</p></li>
<li><p>FS subvolumes, an abstraction for independent CephFS directory trees</p></li>
<li><p>FS subvolume groups, an abstraction for a directory level higher than FS
subvolumes. Used to effect policies (e.g., <a class="reference internal" href="../file-layouts/"><span class="doc">File layouts</span></a>)
across a set of subvolumes</p></li>
</ul>
<p>Some possible use-cases for the export abstractions:</p>
<ul class="simple">
<li><p>FS subvolumes used as Manila shares or CSI volumes</p></li>
<li><p>FS subvolume groups used as Manila share groups</p></li>
</ul>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Nautilus (14.2.x) or later Ceph release</p></li>
<li><p>Cephx client user (see <a class="reference internal" href="../../rados/operations/user-management/"><span class="doc">User Management</span></a>) with
at least the following capabilities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span> <span class="s1">&#39;allow r&#39;</span>
<span class="n">mgr</span> <span class="s1">&#39;allow rw&#39;</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="fs-volumes">
<h2>FS Volumes<a class="headerlink" href="#fs-volumes" title="Permalink to this heading">¶</a></h2>
<p>Create a volume by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>volume<span class="w"> </span>create<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span><span class="o">[</span>&lt;placement&gt;<span class="o">]</span></span>
</pre></div></div><p>This creates a CephFS file system and its data and metadata pools. It can also
deploy MDS daemons for the filesystem using a ceph-mgr orchestrator module (for
example Rook). See <a class="reference internal" href="../../mgr/orchestrator/"><span class="doc">Orchestrator CLI</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;vol_name&gt;</span></code> is the volume name (an arbitrary string). <code class="docutils literal notranslate"><span class="pre">&lt;placement&gt;</span></code> is an
optional string that specifies the hosts that should have an MDS running on
them and, optionally, the total number of MDS daemons that the cluster should
have. For example, the following placement string means “deploy MDS on nodes
<code class="docutils literal notranslate"><span class="pre">host1</span></code> and <code class="docutils literal notranslate"><span class="pre">host2</span></code> (one MDS per host):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;host1,host2&quot;</span>
</pre></div>
</div>
<p>The following placement specification means “deploy two MDS daemons on each of
nodes <code class="docutils literal notranslate"><span class="pre">host1</span></code> and <code class="docutils literal notranslate"><span class="pre">host2</span></code> (for a total of four MDS daemons in the
cluster)”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;4 host1,host2&quot;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../../cephadm/services/#orchestrator-cli-service-spec"><span class="std std-ref">Service Specification</span></a> for more on placement specification.
Specifying placement via a YAML file is not supported.</p>
<p>To remove a volume, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>volume<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span><span class="o">[</span>--yes-i-really-mean-it<span class="o">]</span></span>
</pre></div></div><p>This removes a file system and its data and metadata pools. It also tries to
remove MDS daemons using the enabled ceph-mgr orchestrator module.</p>
<p>List volumes by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>volume<span class="w"> </span>ls</span>
</pre></div></div><p>Rename a volume by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>volume<span class="w"> </span>rename<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;new_vol_name&gt;<span class="w"> </span><span class="o">[</span>--yes-i-really-mean-it<span class="o">]</span></span>
</pre></div></div><p>Renaming a volume can be an expensive operation that requires the following:</p>
<ul class="simple">
<li><p>Renaming the orchestrator-managed MDS service to match the &lt;new_vol_name&gt;.
This involves launching a MDS service with <code class="docutils literal notranslate"><span class="pre">&lt;new_vol_name&gt;</span></code> and bringing
down the MDS service with <code class="docutils literal notranslate"><span class="pre">&lt;vol_name&gt;</span></code>.</p></li>
<li><p>Renaming the file system matching <code class="docutils literal notranslate"><span class="pre">&lt;vol_name&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">&lt;new_vol_name&gt;</span></code>.</p></li>
<li><p>Changing the application tags on the data and metadata pools of the file system
to <code class="docutils literal notranslate"><span class="pre">&lt;new_vol_name&gt;</span></code>.</p></li>
<li><p>Renaming the metadata and data pools of the file system.</p></li>
</ul>
<p>The CephX IDs that are authorized for <code class="docutils literal notranslate"><span class="pre">&lt;vol_name&gt;</span></code> must be reauthorized for
<code class="docutils literal notranslate"><span class="pre">&lt;new_vol_name&gt;</span></code>. Any ongoing operations of the clients using these IDs may
be disrupted. Ensure that mirroring is disabled on the volume.</p>
<p>To fetch the information of a CephFS volume, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>volume<span class="w"> </span>info<span class="w"> </span>vol_name<span class="w"> </span><span class="o">[</span>--human_readable<span class="o">]</span></span>
</pre></div></div><p>The <code class="docutils literal notranslate"><span class="pre">--human_readable</span></code> flag shows used and available pool capacities in KB/MB/GB.</p>
<p>The output format is JSON and contains fields as follows:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pools</span></code>: Attributes of data and metadata pools</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">avail</span></code>: The amount of free space available in bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">used</span></code>: The amount of storage consumed in bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Name of the pool</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mon_addrs</span></code>: List of Ceph monitor addresses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">used_size</span></code>: Current used size of the CephFS volume in bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pending_subvolume_deletions</span></code>: Number of subvolumes pending deletion</p></li>
</ul>
<p>Sample output of the <code class="docutils literal notranslate"><span class="pre">volume</span> <span class="pre">info</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs volume info vol_name
{
    &quot;mon_addrs&quot;: [
        &quot;192.168.1.7:40977&quot;
    ],
    &quot;pending_subvolume_deletions&quot;: 0,
    &quot;pools&quot;: {
        &quot;data&quot;: [
            {
                &quot;avail&quot;: 106288709632,
                &quot;name&quot;: &quot;cephfs.vol_name.data&quot;,
                &quot;used&quot;: 4096
            }
        ],
        &quot;metadata&quot;: [
            {
                &quot;avail&quot;: 106288709632,
                &quot;name&quot;: &quot;cephfs.vol_name.meta&quot;,
                &quot;used&quot;: 155648
            }
        ]
    },
    &quot;used_size&quot;: 0
}
</pre></div>
</div>
</section>
<section id="fs-subvolume-groups">
<h2>FS Subvolume groups<a class="headerlink" href="#fs-subvolume-groups" title="Permalink to this heading">¶</a></h2>
<p>Create a subvolume group by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>create<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;<span class="w"> </span><span class="o">[</span>--size<span class="w"> </span>&lt;size_in_bytes&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--pool_layout<span class="w"> </span>&lt;data_pool_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--uid<span class="w"> </span>&lt;uid&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--gid<span class="w"> </span>&lt;gid&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--mode<span class="w"> </span>&lt;octal_mode&gt;<span class="o">]</span></span>
</pre></div></div><p>The command succeeds even if the subvolume group already exists.</p>
<p>When creating a subvolume group you can specify its data pool layout (see
<a class="reference internal" href="../file-layouts/"><span class="doc">File layouts</span></a>), uid, gid, file mode in octal numerals, and
size in bytes. The size of the subvolume group is specified by setting
a quota on it (see <a class="reference internal" href="../quota/"><span class="doc">Quotas</span></a>). By default, the subvolume group
is created with octal file mode <code class="docutils literal notranslate"><span class="pre">755</span></code>, uid <code class="docutils literal notranslate"><span class="pre">0</span></code>, gid <code class="docutils literal notranslate"><span class="pre">0</span></code> and the data pool
layout of its parent directory.</p>
<p>Remove a subvolume group by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;<span class="w"> </span><span class="o">[</span>--force<span class="o">]</span></span>
</pre></div></div><p>The removal of a subvolume group fails if the subvolume group is not empty or
is non-existent. The <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag allows the non-existent “subvolume group
remove command” to succeed.</p>
<p>Fetch the absolute path of a subvolume group by running a command of the
following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>getpath<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;</span>
</pre></div></div><p>List subvolume groups by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>ls<span class="w"> </span>&lt;vol_name&gt;</span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Subvolume group snapshot feature is no longer supported in mainline CephFS (existing group
snapshots can still be listed and deleted)</p>
</div>
<p>Fetch the metadata of a subvolume group by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>info<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;</span>
</pre></div></div><p>The output format is JSON and contains fields as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">atime</span></code>: access time of the subvolume group path in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtime</span></code>: modification time of the subvolume group path in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctime</span></code>: change time of the subvolume group path in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uid</span></code>: uid of the subvolume group path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gid</span></code>: gid of the subvolume group path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: mode of the subvolume group path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mon_addrs</span></code>: list of monitor addresses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_pcent</span></code>: quota used in percentage if quota is set, else displays “undefined”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_quota</span></code>: quota size in bytes if quota is set, else displays “infinite”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_used</span></code>: current used size of the subvolume group in bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created_at</span></code>: creation time of the subvolume group in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_pool</span></code>: data pool to which the subvolume group belongs</p></li>
</ul>
<p>Check the presence of any subvolume group by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>exist<span class="w"> </span>&lt;vol_name&gt;</span>
</pre></div></div><p>The <code class="docutils literal notranslate"><span class="pre">exist</span></code> command outputs:</p>
<ul class="simple">
<li><p>“subvolumegroup exists”: if any subvolumegroup is present</p></li>
<li><p>“no subvolumegroup exists”: if no subvolumegroup is present</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command checks for the presence of custom groups and not
presence of the default one. To validate the emptiness of the volume, a
subvolumegroup existence check alone is not sufficient. Subvolume existence
also needs to be checked as there might be subvolumes in the default group.</p>
</div>
<p>Resize a subvolume group by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>resize<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;<span class="w"> </span>&lt;new_size&gt;<span class="w"> </span><span class="o">[</span>--no_shrink<span class="o">]</span></span>
</pre></div></div><p>The command resizes the subvolume group quota, using the size specified by
<code class="docutils literal notranslate"><span class="pre">new_size</span></code>.  The <code class="docutils literal notranslate"><span class="pre">--no_shrink</span></code> flag prevents the subvolume group from
shrinking below the current used size.</p>
<p>The subvolume group may be resized to an infinite size by passing <code class="docutils literal notranslate"><span class="pre">inf</span></code> or
<code class="docutils literal notranslate"><span class="pre">infinite</span></code> as the <code class="docutils literal notranslate"><span class="pre">new_size</span></code>.</p>
<p>Remove a snapshot of a subvolume group by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>snapshot<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--force<span class="o">]</span></span>
</pre></div></div><p>Supplying the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag allows the command to succeed when it would otherwise
fail due to the nonexistence of the snapshot.</p>
<p>List snapshots of a subvolume group by running a command of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>snapshot<span class="w"> </span>ls<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;</span>
</pre></div></div></section>
<section id="fs-subvolumes">
<h2>FS Subvolumes<a class="headerlink" href="#fs-subvolumes" title="Permalink to this heading">¶</a></h2>
<p>Create a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>create<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span><span class="o">[</span>--size<span class="w"> </span>&lt;size_in_bytes&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--pool_layout<span class="w"> </span>&lt;data_pool_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--uid<span class="w"> </span>&lt;uid&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--gid<span class="w"> </span>&lt;gid&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--mode<span class="w"> </span>&lt;octal_mode&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--namespace-isolated<span class="o">]</span></span>
</pre></div></div><p>The command succeeds even if the subvolume already exists.</p>
<p>When creating a subvolume you can specify its subvolume group, data pool
layout, uid, gid, file mode in octal numerals, and size in bytes. The size of
the subvolume is specified by setting a quota on it (see <a class="reference internal" href="../quota/"><span class="doc">Quotas</span></a>).
The subvolume can be created in a separate RADOS namespace by specifying
–namespace-isolated option. By default a subvolume is created within the
default subvolume group, and with an octal file mode ‘755’, uid of its
subvolume group, gid of its subvolume group, data pool layout of its parent
directory and no size limit.</p>
<p>Remove a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--force<span class="o">]</span><span class="w"> </span><span class="o">[</span>--retain-snapshots<span class="o">]</span></span>
</pre></div></div><p>The command removes the subvolume and its contents. It does this in two steps.
First, it moves the subvolume to a trash folder, and then asynchronously purges
its contents.</p>
<p>The removal of a subvolume fails if it has snapshots, or is non-existent.
‘–force’ flag allows the non-existent subvolume remove command to succeed.</p>
<p>A subvolume can be removed retaining existing snapshots of the subvolume using the
‘–retain-snapshots’ option. If snapshots are retained, the subvolume is considered
empty for all operations not involving the retained snapshots.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Snapshot retained subvolumes can be recreated using ‘ceph fs
subvolume create’</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Retained snapshots can be used as a clone source to recreate the
subvolume, or clone to a newer subvolume.</p>
</div>
<p>Resize a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>resize<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;new_size&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--no_shrink<span class="o">]</span></span>
</pre></div></div><p>The command resizes the subvolume quota using the size specified by
<code class="docutils literal notranslate"><span class="pre">new_size</span></code>.  The <cite>–no_shrink`</cite> flag prevents the subvolume from shrinking
below the current  used size of the subvolume.</p>
<p>The subvolume can be resized to an unlimited (but sparse) logical size by
passing <code class="docutils literal notranslate"><span class="pre">inf</span></code> or <code class="docutils literal notranslate"><span class="pre">infinite</span></code> as `` new_size``.</p>
<p>Authorize cephx auth IDs, the read/read-write access to fs subvolumes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>authorize<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;sub_name&gt;<span class="w"> </span>&lt;auth_id&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="o">=</span>&lt;group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--access_level<span class="o">=</span>&lt;access_level&gt;<span class="o">]</span></span>
</pre></div></div><p>The <code class="docutils literal notranslate"><span class="pre">access_level</span></code> takes <code class="docutils literal notranslate"><span class="pre">r</span></code> or <code class="docutils literal notranslate"><span class="pre">rw</span></code> as value.</p>
<p>Deauthorize cephx auth IDs, the read/read-write access to fs subvolumes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>deauthorize<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;sub_name&gt;<span class="w"> </span>&lt;auth_id&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="o">=</span>&lt;group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>List cephx auth IDs authorized to access fs subvolume:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>authorized_list<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;sub_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="o">=</span>&lt;group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Evict fs clients based on auth ID and subvolume mounted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>evict<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;sub_name&gt;<span class="w"> </span>&lt;auth_id&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="o">=</span>&lt;group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Fetch the absolute path of a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>getpath<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Fetch the information of a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>info<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>The output format is JSON and contains fields as follows.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">atime</span></code>: access time of the subvolume path in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtime</span></code>: modification time of the subvolume path in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctime</span></code>: change time of the subvolume path in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uid</span></code>: uid of the subvolume path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gid</span></code>: gid of the subvolume path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: mode of the subvolume path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mon_addrs</span></code>: list of monitor addresses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_pcent</span></code>: quota used in percentage if quota is set, else displays <code class="docutils literal notranslate"><span class="pre">undefined</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_quota</span></code>: quota size in bytes if quota is set, else displays <code class="docutils literal notranslate"><span class="pre">infinite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_used</span></code>: current used size of the subvolume in bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created_at</span></code>: creation time of the subvolume in the format “YYYY-MM-DD HH:MM:SS”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_pool</span></code>: data pool to which the subvolume belongs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: absolute path of a subvolume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: subvolume type indicating whether it’s clone or subvolume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pool_namespace</span></code>: RADOS namespace of the subvolume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code>: features supported by the subvolume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code>: current state of the subvolume</p></li>
</ul>
<p>If a subvolume has been removed retaining its snapshots, the output contains only fields as follows.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: subvolume type indicating whether it’s clone or subvolume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code>: features supported by the subvolume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code>: current state of the subvolume</p></li>
</ul>
<p>A subvolume’s <code class="docutils literal notranslate"><span class="pre">features</span></code> are based on the internal version of the subvolume and are
a subset of the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot-clone</span></code>: supports cloning using a subvolumes snapshot as the source</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot-autoprotect</span></code>: supports automatically protecting snapshots, that are active clone sources, from deletion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot-retention</span></code>: supports removing subvolume contents, retaining any existing snapshots</p></li>
</ul>
<p>A subvolume’s <code class="docutils literal notranslate"><span class="pre">state</span></code> is based on the current state of the subvolume and contains one of the following values.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">complete</span></code>: subvolume is ready for all operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshot-retained</span></code>: subvolume is removed but its snapshots are retained</p></li>
</ul>
<p>List subvolumes using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>ls<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>subvolumes that are removed but have snapshots retained, are also
listed.</p>
</div>
<p>Check the presence of any subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>exist<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>These are the possible results of the <code class="docutils literal notranslate"><span class="pre">exist</span></code> command:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">subvolume</span> <span class="pre">exists</span></code>: if any subvolume of given group_name is present</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">subvolume</span> <span class="pre">exists</span></code>: if no subvolume of given group_name is present</p></li>
</ul>
<p>Set custom metadata on the subvolume as a key-value pair using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>metadata<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;key_name&gt;<span class="w"> </span>&lt;value&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the key_name already exists then the old value will get replaced
by the new value.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>key_name and value should be a string of ASCII characters (as
specified in python’s string.printable). key_name is case-insensitive and
always stored in lower case.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Custom metadata on a subvolume is not preserved when snapshotting the
subvolume, and hence, is also not preserved when cloning the subvolume
snapshot.</p>
</div>
<p>Get custom metadata set on the subvolume using the metadata key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>metadata<span class="w"> </span>get<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;key_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>List custom metadata (key-value pairs) set on the subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>metadata<span class="w"> </span>ls<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Remove custom metadata set on the subvolume using the metadata key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>metadata<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;key_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--force<span class="o">]</span></span>
</pre></div></div><p>Using the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag allows the command to succeed that would otherwise
fail if the metadata key did not exist.</p>
<p>Create a snapshot of a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Remove a snapshot of a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--force<span class="o">]</span></span>
</pre></div></div><p>Using the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag allows the command to succeed that would otherwise
fail if the snapshot did not exist.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if the last snapshot within a snapshot retained subvolume is removed,
the subvolume is also removed</p>
</div>
<p>List snapshots of a subvolume using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>ls<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Fetch the information of a snapshot using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>info<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>The output format is JSON and contains fields as follows.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">created_at</span></code>: creation time of the snapshot in the format “YYYY-MM-DD HH:MM:SS:ffffff”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_pool</span></code>: data pool to which the snapshot belongs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_pending_clones</span></code>: <code class="docutils literal notranslate"><span class="pre">yes</span></code> if snapshot clone is in progress, otherwise <code class="docutils literal notranslate"><span class="pre">no</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pending_clones</span></code>: list of in-progress or pending clones and their target group if any exist, otherwise this field is not shown</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orphan_clones_count</span></code>: count of orphan clones if the snapshot has orphan clones, otherwise this field is not shown</p></li>
</ul>
<p>Sample output when snapshot clones are in progress or pending:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs subvolume snapshot info cephfs subvol snap
{
    &quot;created_at&quot;: &quot;2022-06-14 13:54:58.618769&quot;,
    &quot;data_pool&quot;: &quot;cephfs.cephfs.data&quot;,
    &quot;has_pending_clones&quot;: &quot;yes&quot;,
    &quot;pending_clones&quot;: [
        {
            &quot;name&quot;: &quot;clone_1&quot;,
            &quot;target_group&quot;: &quot;target_subvol_group&quot;
        },
        {
            &quot;name&quot;: &quot;clone_2&quot;
        },
        {
            &quot;name&quot;: &quot;clone_3&quot;,
            &quot;target_group&quot;: &quot;target_subvol_group&quot;
        }
    ]
}
</pre></div>
</div>
<p>Sample output when no snapshot clone is in progress or pending:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs subvolume snapshot info cephfs subvol snap
{
    &quot;created_at&quot;: &quot;2022-06-14 13:54:58.618769&quot;,
    &quot;data_pool&quot;: &quot;cephfs.cephfs.data&quot;,
    &quot;has_pending_clones&quot;: &quot;no&quot;
}
</pre></div>
</div>
<p>Set custom key-value metadata on the snapshot by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>metadata<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;key_name&gt;<span class="w"> </span>&lt;value&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the key_name already exists then the old value will get replaced
by the new value.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The key_name and value should be a strings of ASCII characters (as
specified in Python’s <code class="docutils literal notranslate"><span class="pre">string.printable</span></code>). The key_name is
case-insensitive and always stored in lowercase.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Custom metadata on a snapshot is not preserved when snapshotting the
subvolume, and hence is also not preserved when cloning the subvolume
snapshot.</p>
</div>
<p>Get custom metadata set on the snapshot using the metadata key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>metadata<span class="w"> </span>get<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;key_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>List custom metadata (key-value pairs) set on the snapshot using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>metadata<span class="w"> </span>ls<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>Remove custom metadata set on the snapshot using the metadata key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>metadata<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;key_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--force<span class="o">]</span></span>
</pre></div></div><p>Using the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag allows the command to succeed that would otherwise
fail if the metadata key did not exist.</p>
</section>
<section id="cloning-snapshots">
<h2>Cloning Snapshots<a class="headerlink" href="#cloning-snapshots" title="Permalink to this heading">¶</a></h2>
<p>Subvolumes can be created by cloning subvolume snapshots. Cloning is an
asynchronous operation that copies data from a snapshot to a subvolume. Due to
this bulk copying, cloning is inefficient for very large data sets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Removing a snapshot (source subvolume) would fail if there are
pending or in progress clone operations.</p>
</div>
<p>Protecting snapshots prior to cloning was a prerequisite in the Nautilus
release, and the commands to protect/unprotect snapshots were introduced for
this purpose. This prerequisite, and hence the commands to protect/unprotect,
is being deprecated and may be removed from a future release.</p>
<p>The commands being deprecated are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt2:before {
  content: "# ";
}
</style><span class="prompt2">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>protect<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
<span class="prompt2">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>unprotect<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;<span class="o">]</span></span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the above commands will not result in an error, but they have
no useful purpose.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">subvolume</span> <span class="pre">info</span></code> command to fetch subvolume metadata
regarding supported <code class="docutils literal notranslate"><span class="pre">features</span></code> to help decide if protect/unprotect of
snapshots is required, based on the availability of the
<code class="docutils literal notranslate"><span class="pre">snapshot-autoprotect</span></code> feature.</p>
</div>
<p>To initiate a clone operation use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>clone<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;target_subvol_name&gt;</span>
</pre></div></div><p>If a snapshot (source subvolume) is a part of non-default group, the group name
needs to be specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>clone<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;target_subvol_name&gt;<span class="w"> </span>--group_name<span class="w"> </span>&lt;subvol_group_name&gt;</span>
</pre></div></div><p>Cloned subvolumes can be a part of a different group than the source snapshot
(by default, cloned subvolumes are created in default group). To clone to a
particular group use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">$<span class="w"> </span>ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>clone<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;target_subvol_name&gt;<span class="w"> </span>--target_group_name<span class="w"> </span>&lt;subvol_group_name&gt;</span>
</pre></div></div><p>Similar to specifying a pool layout when creating a subvolume, pool layout can
be specified when creating a cloned subvolume. To create a cloned subvolume
with a specific pool layout use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>clone<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;subvol_name&gt;<span class="w"> </span>&lt;snap_name&gt;<span class="w"> </span>&lt;target_subvol_name&gt;<span class="w"> </span>--pool_layout<span class="w"> </span>&lt;pool_layout&gt;</span>
</pre></div></div><p>Configure the maximum number of concurrent clones. The default is 4:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mgr<span class="w"> </span>mgr/volumes/max_concurrent_clones<span class="w"> </span>&lt;value&gt;</span>
</pre></div></div><p>To check the status of a clone operation use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>clone<span class="w"> </span>status<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;clone_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>A clone can be in one of the following states:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pending</span></code>     : Clone operation has not started</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in-progress</span></code> : Clone operation is in progress</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">complete</span></code>    : Clone operation has successfully finished</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failed</span></code>      : Clone operation has failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">canceled</span></code>    : Clone operation is cancelled by user</p></li>
</ol>
<p>The reason for a clone failure is shown as below:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">errno</span></code>     : error number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_msg</span></code> : failure error string</p></li>
</ol>
<p>Here is an example of an <code class="docutils literal notranslate"><span class="pre">in-progress</span></code> clone:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs subvolume snapshot clone cephfs subvol1 snap1 clone1
$ ceph fs clone status cephfs clone1
{
  &quot;status&quot;: {
    &quot;state&quot;: &quot;in-progress&quot;,
    &quot;source&quot;: {
      &quot;volume&quot;: &quot;cephfs&quot;,
      &quot;subvolume&quot;: &quot;subvol1&quot;,
      &quot;snapshot&quot;: &quot;snap1&quot;
    }
  }
}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">failure</span></code> section will be shown only if the clone’s state is
<code class="docutils literal notranslate"><span class="pre">failed</span></code> or <code class="docutils literal notranslate"><span class="pre">cancelled</span></code></p>
</div>
<p>Here is an example of a <code class="docutils literal notranslate"><span class="pre">failed</span></code> clone:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs subvolume snapshot clone cephfs subvol1 snap1 clone1
$ ceph fs clone status cephfs clone1
{
  &quot;status&quot;: {
    &quot;state&quot;: &quot;failed&quot;,
    &quot;source&quot;: {
      &quot;volume&quot;: &quot;cephfs&quot;,
      &quot;subvolume&quot;: &quot;subvol1&quot;,
      &quot;snapshot&quot;: &quot;snap1&quot;
      &quot;size&quot;: &quot;104857600&quot;
    },
    &quot;failure&quot;: {
      &quot;errno&quot;: &quot;122&quot;,
      &quot;errstr&quot;: &quot;Disk quota exceeded&quot;
    }
  }
}
</pre></div>
</div>
<p>(NOTE: since <code class="docutils literal notranslate"><span class="pre">subvol1</span></code> is in the default group, the <code class="docutils literal notranslate"><span class="pre">source</span></code> object’s
<code class="docutils literal notranslate"><span class="pre">clone</span> <span class="pre">status</span></code> does not include the group name)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cloned subvolumes are accessible only after the clone operation has
successfully completed.</p>
</div>
<p>After a successful clone operation, <code class="docutils literal notranslate"><span class="pre">clone</span> <span class="pre">status</span></code> will look like the below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ceph fs clone status cephfs clone1
{
  &quot;status&quot;: {
    &quot;state&quot;: &quot;complete&quot;
  }
}
</pre></div>
</div>
<p>If a clone operation is unsuccessful, the <code class="docutils literal notranslate"><span class="pre">state</span></code> value will be  <code class="docutils literal notranslate"><span class="pre">failed</span></code>.</p>
<p>To retry a failed clone operation, the incomplete clone must be deleted and the
clone operation must be issued again.  To delete a partial clone use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>rm<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;clone_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;group_name&gt;<span class="o">]</span><span class="w"> </span>--force</span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cloning synchronizes only directories, regular files and symbolic
links. Inode timestamps (access and modification times) are synchronized up
to seconds granularity.</p>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">in-progress</span></code> or a <code class="docutils literal notranslate"><span class="pre">pending</span></code> clone operation may be canceled. To cancel
a clone operation use the <code class="docutils literal notranslate"><span class="pre">clone</span> <span class="pre">cancel</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>clone<span class="w"> </span>cancel<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;clone_name&gt;<span class="w"> </span><span class="o">[</span>--group_name<span class="w"> </span>&lt;group_name&gt;<span class="o">]</span></span>
</pre></div></div><p>On successful cancellation, the cloned subvolume is moved to the <code class="docutils literal notranslate"><span class="pre">canceled</span></code> state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt2">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>clone<span class="w"> </span>cephfs<span class="w"> </span>subvol1<span class="w"> </span>snap1<span class="w"> </span>clone1</span>
<span class="prompt2">ceph<span class="w"> </span>fs<span class="w"> </span>clone<span class="w"> </span>cancel<span class="w"> </span>cephfs<span class="w"> </span>clone1</span>
<span class="prompt2">ceph<span class="w"> </span>fs<span class="w"> </span>clone<span class="w"> </span>status<span class="w"> </span>cephfs<span class="w"> </span>clone1</span>
</pre></div></div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">{</span>
      <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;canceled&quot;</span><span class="p">,</span>
          <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="s2">&quot;cephfs&quot;</span><span class="p">,</span>
              <span class="s2">&quot;subvolume&quot;</span><span class="p">:</span> <span class="s2">&quot;subvol1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;snapshot&quot;</span><span class="p">:</span> <span class="s2">&quot;snap1&quot;</span>
          <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The canceled cloned may be deleted by supplying the <code class="docutils literal notranslate"><span class="pre">--force</span></code>
option to the <cite>fs subvolume rm</cite> command.</p>
</div>
</section>
<section id="pinning-subvolumes-and-subvolume-groups">
<span id="subvol-pinning"></span><h2>Pinning Subvolumes and Subvolume Groups<a class="headerlink" href="#pinning-subvolumes-and-subvolume-groups" title="Permalink to this heading">¶</a></h2>
<p>Subvolumes and subvolume groups may be automatically pinned to ranks according
to policies. This can distribute load across MDS ranks in predictable and
stable ways.  Review <a class="reference internal" href="../multimds/#cephfs-pinning"><span class="std std-ref">Manually pinning directory trees to a particular rank</span></a> and <a class="reference internal" href="../multimds/#cephfs-ephemeral-pinning"><span class="std std-ref">Setting subtree partitioning policies</span></a>
for details on how pinning works.</p>
<p>Pinning is configured by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>pin<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;<span class="w"> </span>&lt;pin_type&gt;<span class="w"> </span>&lt;pin_setting&gt;</span>
</pre></div></div><p>or for subvolumes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolume<span class="w"> </span>pin<span class="w"> </span>&lt;vol_name&gt;<span class="w"> </span>&lt;group_name&gt;<span class="w"> </span>&lt;pin_type&gt;<span class="w"> </span>&lt;pin_setting&gt;</span>
</pre></div></div><p>Typically you will want to set subvolume group pins. The <code class="docutils literal notranslate"><span class="pre">pin_type</span></code> may be
one of <code class="docutils literal notranslate"><span class="pre">export</span></code>, <code class="docutils literal notranslate"><span class="pre">distributed</span></code>, or <code class="docutils literal notranslate"><span class="pre">random</span></code>. The <code class="docutils literal notranslate"><span class="pre">pin_setting</span></code>
corresponds to the extended attributed “value” as in the pinning documentation
referenced above.</p>
<p>So, for example, setting a distributed pinning strategy on a subvolume group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span>subvolumegroup<span class="w"> </span>pin<span class="w"> </span>cephfilesystem-a<span class="w"> </span>csi<span class="w"> </span>distributed<span class="w"> </span><span class="m">1</span></span>
</pre></div></div><p>Will enable distributed subtree partitioning policy for the “csi” subvolume
group.  This will cause every subvolume within the group to be automatically
pinned to one of the available ranks on the file system.</p>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph File System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../#getting-started-with-cephfs">Getting Started with CephFS</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../#administration">Administration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../createfs/"> Create a CephFS file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/"> Administrative commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multifs/"> Creating Multiple File Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add-remove-mds/"> Provision/Add/Remove MDS(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#referring-to-mds-daemons">Referring to MDS daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#managing-failover">Managing failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-standby-replay">Configuring standby-replay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-mds-file-system-affinity">Configuring MDS file system affinity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cache-configuration/"> MDS Cache Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mds-config-ref/"> MDS Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-mds/"> Manual: ceph-mds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfs/"> Export over NFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-best-practices/"> Application best practices</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"> FS volume and subvolumes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fs-volumes">FS Volumes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fs-subvolume-groups">FS Subvolume groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fs-subvolumes">FS Subvolumes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cloning-snapshots">Cloning Snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pinning-subvolumes-and-subvolume-groups">Pinning Subvolumes and Subvolume Groups</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../quota/"> CephFS Quotas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../health-messages/"> Health messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/">Upgrading the MDS Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/#upgrading-pre-firefly-file-systems-past-jewel">Upgrading pre-Firefly file systems past Jewel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-top/"> CephFS Top Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../snap-schedule/"> Scheduled Snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-mirroring/"> CephFS Snapshot Mirroring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#mounting-cephfs">Mounting CephFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#cephfs-concepts">CephFS Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#troubleshooting-and-disaster-recovery">Troubleshooting and Disaster Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#developer-guides">Developer Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#additional-details">Additional Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../quota/" title="Quotas"
             >next</a> |</li>
        <li class="right" >
          <a href="../app-best-practices/" title="Application best practices for distributed file systems"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph File System</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">FS volumes and subvolumes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>