
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>CephFS health messages &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Upgrading the MDS Cluster" href="../upgrading/" />
    <link rel="prev" title="Quotas" href="../quota/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../upgrading/" title="Upgrading the MDS Cluster"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../quota/" title="Quotas"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph File System</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CephFS health messages</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="cephfs-health-messages">
<span id="id1"></span><h1>CephFS health messages<a class="headerlink" href="#cephfs-health-messages" title="Permalink to this heading">¶</a></h1>
<section id="cluster-health-checks">
<h2>Cluster health checks<a class="headerlink" href="#cluster-health-checks" title="Permalink to this heading">¶</a></h2>
<p>The Ceph monitor daemons will generate health messages in response
to certain states of the file system map structure (and the enclosed MDS maps).</p>
<p>Message: mds rank(s) <em>ranks</em> have failed
Description: One or more MDS ranks are not currently assigned to
an MDS daemon; the cluster will not recover until a suitable replacement
daemon starts.</p>
<p>Message: mds rank(s) <em>ranks</em> are damaged
Description: One or more MDS ranks has encountered severe damage to
its stored metadata, and cannot start again until it is repaired.</p>
<p>Message: mds cluster is degraded
Description: One or more MDS ranks are not currently up and running, clients
may pause metadata IO until this situation is resolved.  This includes
ranks being failed or damaged, and additionally includes ranks
which are running on an MDS but have not yet made it to the <em>active</em>
state (e.g. ranks currently in <em>replay</em> state).</p>
<p>Message: mds <em>names</em> are laggy
Description: The named MDS daemons have failed to send beacon messages
to the monitor for at least <code class="docutils literal notranslate"><span class="pre">mds_beacon_grace</span></code> (default 15s), while
they are supposed to send beacon messages every <code class="docutils literal notranslate"><span class="pre">mds_beacon_interval</span></code>
(default 4s).  The daemons may have crashed.  The Ceph monitor will
automatically replace laggy daemons with standbys if any are available.</p>
<p>Message: insufficient standby daemons available
Description: One or more file systems are configured to have a certain number
of standby daemons available (including daemons in standby-replay) but the
cluster does not have enough standby daemons. The standby daemons not in replay
count towards any file system (i.e. they may overlap). This warning can
configured by setting <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">fs</span> <span class="pre">set</span> <span class="pre">&lt;fs&gt;</span> <span class="pre">standby_count_wanted</span> <span class="pre">&lt;count&gt;</span></code>.  Use
zero for <code class="docutils literal notranslate"><span class="pre">count</span></code> to disable.</p>
</section>
<section id="daemon-reported-health-checks">
<h2>Daemon-reported health checks<a class="headerlink" href="#daemon-reported-health-checks" title="Permalink to this heading">¶</a></h2>
<p>MDS daemons can identify a variety of unwanted conditions, and
indicate these to the operator in the output of <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">status</span></code>.
These conditions have human readable messages, and additionally
a unique code starting with <code class="docutils literal notranslate"><span class="pre">MDS_</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">health</span> <span class="pre">detail</span></code> shows the details of the conditions. Following
is a typical health report from a cluster experiencing MDS related
performance issues:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ceph<span class="w"> </span>health<span class="w"> </span>detail
<span class="go">HEALTH_WARN 1 MDSs report slow metadata IOs; 1 MDSs report slow requests</span>
<span class="go">MDS_SLOW_METADATA_IO 1 MDSs report slow metadata IOs</span>
<span class="go">   mds.fs-01(mds.0): 3 slow metadata IOs are blocked &gt; 30 secs, oldest blocked for 51123 secs</span>
<span class="go">MDS_SLOW_REQUEST 1 MDSs report slow requests</span>
<span class="go">   mds.fs-01(mds.0): 5 slow requests are blocked &gt; 30 secs</span>
</pre></div>
</div>
<p>Where, for intance, <code class="docutils literal notranslate"><span class="pre">MDS_SLOW_REQUEST</span></code> is the unique code representing the
condition where requests are taking long time to complete. And the following
description shows its severity and the MDS daemons which are serving these
slow requests.</p>
<p>This page lists the health checks raised by MDS daemons. For the checks from
other daemons, please see <a class="reference internal" href="../../rados/operations/health-checks/#health-checks"><span class="std std-ref">Health checks</span></a>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_TRIM</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Behind on trimming…”</p>
</dd>
<dt>Description</dt><dd><p>CephFS maintains a metadata journal that is divided into
<em>log segments</em>.  The length of journal (in number of segments) is controlled
by the setting <code class="docutils literal notranslate"><span class="pre">mds_log_max_segments</span></code>, and when the number of segments
exceeds that setting the MDS starts writing back metadata so that it
can remove (trim) the oldest segments.  If this writeback is happening
too slowly, or a software bug is preventing trimming, then this health
message may appear.  The threshold for this message to appear is controlled by
the config option <code class="docutils literal notranslate"><span class="pre">mds_log_warn_factor</span></code>, the default is 2.0.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_HEALTH_CLIENT_LATE_RELEASE</span></code>, <code class="docutils literal notranslate"><span class="pre">MDS_HEALTH_CLIENT_LATE_RELEASE_MANY</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Client <em>name</em> failing to respond to capability release”</p>
</dd>
<dt>Description</dt><dd><p>CephFS clients are issued <em>capabilities</em> by the MDS, which
are like locks.  Sometimes, for example when another client needs access,
the MDS will request clients release their capabilities.  If the client
is unresponsive or buggy, it might fail to do so promptly or fail to do
so at all.  This message appears if a client has taken longer than
<code class="docutils literal notranslate"><span class="pre">session_timeout</span></code> (default 60s) to comply.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_CLIENT_RECALL</span></code>, <code class="docutils literal notranslate"><span class="pre">MDS_HEALTH_CLIENT_RECALL_MANY</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Client <em>name</em> failing to respond to cache pressure”</p>
</dd>
<dt>Description</dt><dd><p>Clients maintain a metadata cache.  Items (such as inodes) in the
client cache are also pinned in the MDS cache, so when the MDS needs to shrink
its cache (to stay within <code class="docutils literal notranslate"><span class="pre">mds_cache_memory_limit</span></code>), it sends messages to
clients to shrink their caches too.  If the client is unresponsive or buggy,
this can prevent the MDS from properly staying within its cache limits and it
may eventually run out of memory and crash.  This message appears if a client
has failed to release more than
<code class="docutils literal notranslate"><span class="pre">mds_recall_warning_threshold</span></code> capabilities (decaying with a half-life of
<code class="docutils literal notranslate"><span class="pre">mds_recall_max_decay_rate</span></code>) within the last
<code class="docutils literal notranslate"><span class="pre">mds_recall_warning_decay_rate</span></code> second.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_CLIENT_OLDEST_TID</span></code>, <code class="docutils literal notranslate"><span class="pre">MDS_CLIENT_OLDEST_TID_MANY</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Client <em>name</em> failing to advance its oldest client/flush tid”</p>
</dd>
<dt>Description</dt><dd><p>The CephFS client-MDS protocol uses a field called the
<em>oldest tid</em> to inform the MDS of which client requests are fully
complete and may therefore be forgotten about by the MDS.  If a buggy
client is failing to advance this field, then the MDS may be prevented
from properly cleaning up resources used by client requests.  This message
appears if a client appears to have more than <code class="docutils literal notranslate"><span class="pre">max_completed_requests</span></code>
(default 100000) requests that are complete on the MDS side but haven’t
yet been accounted for in the client’s <em>oldest tid</em> value. The last tid
used by the MDS to trim completed client requests (or flush) is included
as part of <cite>session ls</cite> (or <cite>client ls</cite>) command as a debug aid.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_DAMAGE</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Metadata damage detected”</p>
</dd>
<dt>Description</dt><dd><p>Corrupt or missing metadata was encountered when reading
from the metadata pool.  This message indicates that the damage was
sufficiently isolated for the MDS to continue operating, although
client accesses to the damaged subtree will return IO errors.  Use
the <code class="docutils literal notranslate"><span class="pre">damage</span> <span class="pre">ls</span></code> admin socket command to get more detail on the damage.
This message appears as soon as any damage is encountered.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_HEALTH_READ_ONLY</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“MDS in read-only mode”</p>
</dd>
<dt>Description</dt><dd><p>The MDS has gone into readonly mode and will return EROFS
error codes to client operations that attempt to modify any metadata.  The
MDS will go into readonly mode if it encounters a write error while
writing to the metadata pool, or if forced to by an administrator using
the <em>force_readonly</em> admin socket command.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_SLOW_REQUEST</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“<em>N</em> slow requests are blocked”</p>
</dd>
<dt>Description</dt><dd><p>One or more client requests have not been completed promptly,
indicating that the MDS is either running very slowly, or that the RADOS
cluster is not acknowledging journal writes promptly, or that there is a bug.
Use the <code class="docutils literal notranslate"><span class="pre">ops</span></code> admin socket command to list outstanding metadata operations.
This message appears if any client requests have taken longer than
<code class="docutils literal notranslate"><span class="pre">mds_op_complaint_time</span></code> (default 30s).</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_CACHE_OVERSIZED</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Too many inodes in cache”</p>
</dd>
<dt>Description</dt><dd><p>The MDS is not succeeding in trimming its cache to comply with the
limit set by the administrator.  If the MDS cache becomes too large, the daemon
may exhaust available memory and crash.  By default, this message appears if
the actual cache size (in memory) is at least 50% greater than
<code class="docutils literal notranslate"><span class="pre">mds_cache_memory_limit</span></code> (default 1GB). Modify <code class="docutils literal notranslate"><span class="pre">mds_health_cache_threshold</span></code>
to set the warning ratio.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDS_CLIENTS_LAGGY</span></code></p>
<dl class="simple">
<dt>Message</dt><dd><p>“Client <em>ID</em> is laggy; not evicted because some OSD(s) is/are laggy”</p>
</dd>
<dt>Description</dt><dd><p>If OSD(s) is laggy (due to certain conditions like network cut-off, etc)
then it might make clients laggy(session might get idle or cannot flush
dirty data for cap revokes). If <code class="docutils literal notranslate"><span class="pre">defer_client_eviction_on_laggy_osds</span></code> is
set to true (default true), client eviction will not take place and thus
this health warning will be generated.</p>
</dd>
</dl>
</li>
</ul>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph File System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../#getting-started-with-cephfs">Getting Started with CephFS</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../#administration">Administration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../createfs/"> Create a CephFS file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/"> Administrative commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multifs/"> Creating Multiple File Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add-remove-mds/"> Provision/Add/Remove MDS(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#referring-to-mds-daemons">Referring to MDS daemons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#managing-failover">Managing failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-standby-replay">Configuring standby-replay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../standby/#configuring-mds-file-system-affinity">Configuring MDS file system affinity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cache-configuration/"> MDS Cache Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mds-config-ref/"> MDS Configuration Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../man/8/ceph-mds/"> Manual: ceph-mds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfs/"> Export over NFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-best-practices/"> Application best practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fs-volumes/"> FS volume and subvolumes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quota/"> CephFS Quotas</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"> Health messages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cluster-health-checks">Cluster health checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#daemon-reported-health-checks">Daemon-reported health checks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/">Upgrading the MDS Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrading/#upgrading-pre-firefly-file-systems-past-jewel">Upgrading pre-Firefly file systems past Jewel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-top/"> CephFS Top Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../snap-schedule/"> Scheduled Snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-mirroring/"> CephFS Snapshot Mirroring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#mounting-cephfs">Mounting CephFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#cephfs-concepts">CephFS Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#troubleshooting-and-disaster-recovery">Troubleshooting and Disaster Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#developer-guides">Developer Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#additional-details">Additional Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../upgrading/" title="Upgrading the MDS Cluster"
             >next</a> |</li>
        <li class="right" >
          <a href="../quota/" title="Quotas"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph File System</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CephFS health messages</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>