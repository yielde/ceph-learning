
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Differences from POSIX &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="MDS Journaling" href="../mds-journaling/" />
    <link rel="prev" title="MDS States" href="../mds-states/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../mds-journaling/" title="MDS Journaling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../mds-states/" title="MDS States"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Ceph File System</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Differences from POSIX</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="differences-from-posix">
<h1>Differences from POSIX<a class="headerlink" href="#differences-from-posix" title="Permalink to this heading">¶</a></h1>
<p>CephFS aims to adhere to POSIX semantics wherever possible.  For
example, in contrast to many other common network file systems like
NFS, CephFS maintains strong cache coherency across clients.  The goal
is for processes communicating via the file system to behave the same
when they are on different hosts as when they are on the same host.</p>
<p>However, there are a few places where CephFS diverges from strict
POSIX semantics for various reasons:</p>
<ul class="simple">
<li><p>If a client is writing to a file and fails, its writes are not
necessarily atomic. That is, the client may call write(2) on a file
opened with O_SYNC with an 8 MB buffer and then crash and the write
may be only partially applied.  (Almost all file systems, even local
file systems, have this behavior.)</p></li>
<li><p>In shared simultaneous writer situations, a write that crosses
object boundaries is not necessarily atomic. This means that you
could have writer A write “aa|aa” and writer B write “bb|bb”
simultaneously (where | is the object boundary), and end up with
“aa|bb” rather than the proper “aa|aa” or “bb|bb”.</p></li>
<li><p>Sparse files propagate incorrectly to the stat(2) st_blocks field.
Because CephFS does not explicitly track which parts of a file are
allocated/written, the st_blocks field is always populated by the
file size divided by the block size.  This will cause tools like
du(1) to overestimate consumed space.  (The recursive size field,
maintained by CephFS, also includes file “holes” in its count.)</p></li>
<li><p>When a file is mapped into memory via mmap(2) on multiple hosts,
writes are not coherently propagated to other clients’ caches.  That
is, if a page is cached on host A, and then updated on host B, host
A’s page is not coherently invalidated.  (Shared writable mmap
appears to be quite rare–we have yet to hear any complaints about this
behavior, and implementing cache coherency properly is complex.)</p></li>
<li><p>CephFS clients present a hidden <code class="docutils literal notranslate"><span class="pre">.snap</span></code> directory that is used to
access, create, delete, and rename snapshots.  Although the virtual
directory is excluded from readdir(2), any process that tries to
create a file or directory with the same name will get an error
code.  The name of this hidden directory can be changed at mount
time with <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">snapdirname=.somethingelse</span></code> (Linux) or the config
option <code class="docutils literal notranslate"><span class="pre">client_snapdir</span></code> (libcephfs, ceph-fuse).</p></li>
</ul>
<section id="perspective">
<h2>Perspective<a class="headerlink" href="#perspective" title="Permalink to this heading">¶</a></h2>
<p>People talk a lot about “POSIX compliance,” but in reality most file
system implementations do not strictly adhere to the spec, including
local Linux file systems like ext4 and XFS.  For example, for
performance reasons, the atomicity requirements for reads are relaxed:
processing reading from a file that is also being written may see torn
results.</p>
<p>Similarly, NFS has extremely weak consistency semantics when multiple
clients are interacting with the same files or directories, opting
instead for “close-to-open”.  In the world of network attached
storage, where most environments use NFS, whether or not the server’s
file system is “fully POSIX” may not be relevant, and whether client
applications notice depends on whether data is being shared between
clients or not.  NFS may also “tear” the results of concurrent writers
as client data may not even be flushed to the server until the file is
closed (and more generally writes will be significantly more
time-shifted than CephFS, leading to less predictable results).</p>
<p>Regardless, these are all similar enough to POSIX, and applications still work
most of the time. Many other storage systems (e.g., HDFS) claim to be
“POSIX-like” but diverge significantly from the standard by dropping support
for things like in-place file modifications, truncate, or directory renames.</p>
</section>
<section id="bottom-line">
<h2>Bottom line<a class="headerlink" href="#bottom-line" title="Permalink to this heading">¶</a></h2>
<p>CephFS relaxes more than local Linux kernel file systems (for example, writes
spanning object boundaries may be torn).  It relaxes strictly less
than NFS when it comes to multiclient consistency, and generally less
than NFS when it comes to write atomicity.</p>
<p>In other words, when it comes to POSIX,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HDFS</span> <span class="o">&lt;</span> <span class="n">NFS</span> <span class="o">&lt;</span> <span class="n">CephFS</span> <span class="o">&lt;</span> <span class="p">{</span><span class="n">XFS</span><span class="p">,</span> <span class="n">ext4</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="fsync-and-error-reporting">
<h2>fsync() and error reporting<a class="headerlink" href="#fsync-and-error-reporting" title="Permalink to this heading">¶</a></h2>
<p>POSIX is somewhat vague about the state of an inode after fsync reports
an error. In general, CephFS uses the standard error-reporting
mechanisms in the client’s kernel, and therefore follows the same
conventions as other file systems.</p>
<p>In modern Linux kernels (v4.17 or later), writeback errors are reported
once to every file description that is open at the time of the error. In
addition, unreported errors that occurred before the file description was
opened will also be returned on fsync.</p>
<p>See <a class="reference external" href="https://wiki.postgresql.org/wiki/Fsync_Errors">PostgreSQL’s summary of fsync() error reporting across operating systems</a> and <a class="reference external" href="https://www.youtube.com/watch?v=74c19hwY2oE">Matthew Wilcox’s
presentation on Linux IO error handling</a> for more information.</p>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph File System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../#getting-started-with-cephfs">Getting Started with CephFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#administration">Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#mounting-cephfs">Mounting CephFS</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../#cephfs-concepts">CephFS Concepts</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../mds-states/"> MDS States</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"> POSIX compatibility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#perspective">Perspective</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bottom-line">Bottom line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fsync-and-error-reporting">fsync() and error reporting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mds-journaling/"> MDS Journaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../file-layouts/"> File layouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mdcache/"> Distributed Metadata Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dynamic-metadata-management/"> Dynamic Metadata Management in CephFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cephfs-io-path/"> CephFS IO Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lazyio/"> LazyIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dirfrags/"> Directory fragmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multimds/"> Multiple active MDS daemons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#troubleshooting-and-disaster-recovery">Troubleshooting and Disaster Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#developer-guides">Developer Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#additional-details">Additional Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../mds-journaling/" title="MDS Journaling"
             >next</a> |</li>
        <li class="right" >
          <a href="../mds-states/" title="MDS States"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Ceph File System</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Differences from POSIX</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>