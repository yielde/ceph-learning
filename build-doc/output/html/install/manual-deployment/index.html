
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Manual Deployment &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Manual Deployment on FreeBSD" href="../manual-freebsd-deployment/" />
    <link rel="prev" title="Install Virtualization for Block Device" href="../install-vm-cloud/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../manual-freebsd-deployment/" title="Manual Deployment on FreeBSD"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../install-vm-cloud/" title="Install Virtualization for Block Device"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Installing Ceph</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index_manual/" accesskey="U">Installation (Manual)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Manual Deployment</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="manual-deployment">
<h1>Manual Deployment<a class="headerlink" href="#manual-deployment" title="Permalink to this heading">¶</a></h1>
<p>All Ceph clusters require at least one monitor, and at least as many OSDs as
copies of an object stored on the cluster.  Bootstrapping the initial monitor(s)
is the first step in deploying a Ceph Storage Cluster. Monitor deployment also
sets important criteria for the entire cluster, such as the number of replicas
for pools, the number of placement groups per OSD, the heartbeat intervals,
whether authentication is required, etc. Most of these values are set by
default, so it’s useful to know about them when setting up your cluster for
production.</p>
<p>We will set up a cluster with <code class="docutils literal notranslate"><span class="pre">node1</span></code> as  the monitor node, and <code class="docutils literal notranslate"><span class="pre">node2</span></code> and
<code class="docutils literal notranslate"><span class="pre">node3</span></code> for OSD nodes.</p>
<p class="ditaa">
<img src="../../_images/ditaa-3075afffe9534d9e227d2e2e7e427a17dbb23ce5.png"/>
</p>
<section id="monitor-bootstrapping">
<h2>Monitor Bootstrapping<a class="headerlink" href="#monitor-bootstrapping" title="Permalink to this heading">¶</a></h2>
<p>Bootstrapping a monitor (a Ceph Storage Cluster, in theory) requires
a number of things:</p>
<ul>
<li><p><strong>Unique Identifier:</strong> The <code class="docutils literal notranslate"><span class="pre">fsid</span></code> is a unique identifier for the cluster,
and stands for File System ID from the days when the Ceph Storage Cluster was
principally for the Ceph File System. Ceph now supports native interfaces,
block devices, and object storage gateway interfaces too, so <code class="docutils literal notranslate"><span class="pre">fsid</span></code> is a
bit of a misnomer.</p></li>
<li><p><strong>Cluster Name:</strong> Ceph clusters have a cluster name, which is a simple string
without spaces. The default cluster name is <code class="docutils literal notranslate"><span class="pre">ceph</span></code>, but you may specify
a different cluster name. Overriding the default cluster name is
especially useful when you are working with multiple clusters and you need to
clearly understand which cluster your are working with.</p>
<p>For example, when you run multiple clusters in a <a class="reference internal" href="../../radosgw/multisite/#multisite"><span class="std std-ref">multisite configuration</span></a>,
the cluster name (e.g., <code class="docutils literal notranslate"><span class="pre">us-west</span></code>, <code class="docutils literal notranslate"><span class="pre">us-east</span></code>) identifies the cluster for
the current CLI session. <strong>Note:</strong> To identify the cluster name on the
command line interface, specify the Ceph configuration file with the
cluster name (e.g., <code class="docutils literal notranslate"><span class="pre">ceph.conf</span></code>, <code class="docutils literal notranslate"><span class="pre">us-west.conf</span></code>, <code class="docutils literal notranslate"><span class="pre">us-east.conf</span></code>, etc.).
Also see CLI usage (<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">--cluster</span> <span class="pre">{cluster-name}</span></code>).</p>
</li>
<li><p><strong>Monitor Name:</strong> Each monitor instance within a cluster has a unique name.
In common practice, the Ceph Monitor name is the host name (we recommend one
Ceph Monitor per host, and no commingling of Ceph OSD Daemons with
Ceph Monitors). You may retrieve the short hostname with <code class="docutils literal notranslate"><span class="pre">hostname</span> <span class="pre">-s</span></code>.</p></li>
<li><p><strong>Monitor Map:</strong> Bootstrapping the initial monitor(s) requires you to
generate a monitor map. The monitor map requires the <code class="docutils literal notranslate"><span class="pre">fsid</span></code>, the cluster
name (or uses the default), and at least one host name and its IP address.</p></li>
<li><p><strong>Monitor Keyring</strong>: Monitors communicate with each other via a
secret key. You must generate a keyring with a monitor secret and provide
it when bootstrapping the initial monitor(s).</p></li>
<li><p><strong>Administrator Keyring</strong>: To use the <code class="docutils literal notranslate"><span class="pre">ceph</span></code> CLI tools, you must have
a <code class="docutils literal notranslate"><span class="pre">client.admin</span></code> user. So you must generate the admin user and keyring,
and you must also add the <code class="docutils literal notranslate"><span class="pre">client.admin</span></code> user to the monitor keyring.</p></li>
</ul>
<p>The foregoing requirements do not imply the creation of a Ceph Configuration
file. However, as a best practice, we recommend creating a Ceph configuration
file and populating it with the <code class="docutils literal notranslate"><span class="pre">fsid</span></code>, the <code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">initial</span> <span class="pre">members</span></code> and the
<code class="docutils literal notranslate"><span class="pre">mon</span> <span class="pre">host</span></code> settings.</p>
<p>You can get and set all of the monitor settings at runtime as well. However,
a Ceph Configuration file may contain only those settings that override the
default values. When you add settings to a Ceph configuration file, these
settings override the default settings. Maintaining those settings in a
Ceph configuration file makes it easier to maintain your cluster.</p>
<p>The procedure is as follows:</p>
<ol class="arabic">
<li><p>Log in to the initial monitor node(s):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="p">{</span><span class="n">hostname</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">node1</span>
</pre></div>
</div>
</li>
<li><p>Ensure you have a directory for the Ceph configuration file. By default,
Ceph uses <code class="docutils literal notranslate"><span class="pre">/etc/ceph</span></code>. When you install <code class="docutils literal notranslate"><span class="pre">ceph</span></code>, the installer will
create the <code class="docutils literal notranslate"><span class="pre">/etc/ceph</span></code> directory automatically.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ceph</span>
</pre></div>
</div>
</li>
<li><p>Create a Ceph configuration file. By default, Ceph uses
<code class="docutils literal notranslate"><span class="pre">ceph.conf</span></code>, where <code class="docutils literal notranslate"><span class="pre">ceph</span></code> reflects the cluster name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
<li><p>Generate a unique ID (i.e., <code class="docutils literal notranslate"><span class="pre">fsid</span></code>) for your cluster.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uuidgen</span>
</pre></div>
</div>
</li>
<li><p>Add the unique ID to your Ceph configuration file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fsid</span> <span class="o">=</span> <span class="p">{</span><span class="n">UUID</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fsid</span> <span class="o">=</span> <span class="n">a7f64266</span><span class="o">-</span><span class="mi">0894</span><span class="o">-</span><span class="mi">4</span><span class="n">f1e</span><span class="o">-</span><span class="n">a635</span><span class="o">-</span><span class="n">d0aeaca0e993</span>
</pre></div>
</div>
</li>
<li><p>Add the initial monitor(s) to your Ceph configuration file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span> <span class="n">initial</span> <span class="n">members</span> <span class="o">=</span> <span class="p">{</span><span class="n">hostname</span><span class="p">}[,{</span><span class="n">hostname</span><span class="p">}]</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span> <span class="n">initial</span> <span class="n">members</span> <span class="o">=</span> <span class="n">node1</span>
</pre></div>
</div>
</li>
<li><p>Add the IP address(es) of the initial monitor(s) to your Ceph configuration
file and save the file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span> <span class="n">host</span> <span class="o">=</span> <span class="p">{</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="p">}[,{</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="p">}]</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span> <span class="n">host</span> <span class="o">=</span> <span class="mf">192.168.0.1</span>
</pre></div>
</div>
<p><strong>Note:</strong> You may use IPv6 addresses instead of IPv4 addresses, but
you must set <code class="docutils literal notranslate"><span class="pre">ms</span> <span class="pre">bind</span> <span class="pre">ipv6</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>. See <a class="reference external" href="../../rados/configuration/network-config-ref">Network Configuration
Reference</a> for details about network configuration.</p>
</li>
<li><p>Create a keyring for your cluster and generate a monitor secret key.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">--</span><span class="n">create</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">mon</span><span class="o">.</span><span class="n">keyring</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span> <span class="o">-</span><span class="n">n</span> <span class="n">mon</span><span class="o">.</span> <span class="o">--</span><span class="n">cap</span> <span class="n">mon</span> <span class="s1">&#39;allow *&#39;</span>
</pre></div>
</div>
</li>
<li><p>Generate an administrator keyring, generate a <code class="docutils literal notranslate"><span class="pre">client.admin</span></code> user and add
the user to the keyring.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">--</span><span class="n">create</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">keyring</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span> <span class="o">-</span><span class="n">n</span> <span class="n">client</span><span class="o">.</span><span class="n">admin</span> <span class="o">--</span><span class="n">cap</span> <span class="n">mon</span> <span class="s1">&#39;allow *&#39;</span> <span class="o">--</span><span class="n">cap</span> <span class="n">osd</span> <span class="s1">&#39;allow *&#39;</span> <span class="o">--</span><span class="n">cap</span> <span class="n">mds</span> <span class="s1">&#39;allow *&#39;</span> <span class="o">--</span><span class="n">cap</span> <span class="n">mgr</span> <span class="s1">&#39;allow *&#39;</span>
</pre></div>
</div>
</li>
<li><p>Generate a bootstrap-osd keyring, generate a <code class="docutils literal notranslate"><span class="pre">client.bootstrap-osd</span></code> user and add
the user to the keyring.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">--</span><span class="n">create</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">osd</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">keyring</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span> <span class="o">-</span><span class="n">n</span> <span class="n">client</span><span class="o">.</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">osd</span> <span class="o">--</span><span class="n">cap</span> <span class="n">mon</span> <span class="s1">&#39;profile bootstrap-osd&#39;</span> <span class="o">--</span><span class="n">cap</span> <span class="n">mgr</span> <span class="s1">&#39;allow r&#39;</span>
</pre></div>
</div>
</li>
<li><p>Add the generated keys to the <code class="docutils literal notranslate"><span class="pre">ceph.mon.keyring</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">mon</span><span class="o">.</span><span class="n">keyring</span> <span class="o">--</span><span class="n">import</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">keyring</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">mon</span><span class="o">.</span><span class="n">keyring</span> <span class="o">--</span><span class="n">import</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">osd</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">keyring</span>
</pre></div>
</div>
</li>
<li><p>Change the owner for <code class="docutils literal notranslate"><span class="pre">ceph.mon.keyring</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="n">ceph</span><span class="p">:</span><span class="n">ceph</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">mon</span><span class="o">.</span><span class="n">keyring</span>
</pre></div>
</div>
</li>
<li><p>Generate a monitor map using the hostname(s), host IP address(es) and the FSID.
Save it as <code class="docutils literal notranslate"><span class="pre">/tmp/monmap</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">monmaptool</span> <span class="o">--</span><span class="n">create</span> <span class="o">--</span><span class="n">add</span> <span class="p">{</span><span class="n">hostname</span><span class="p">}</span> <span class="p">{</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="p">}</span> <span class="o">--</span><span class="n">fsid</span> <span class="p">{</span><span class="n">uuid</span><span class="p">}</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">monmap</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">monmaptool</span> <span class="o">--</span><span class="n">create</span> <span class="o">--</span><span class="n">add</span> <span class="n">node1</span> <span class="mf">192.168.0.1</span> <span class="o">--</span><span class="n">fsid</span> <span class="n">a7f64266</span><span class="o">-</span><span class="mi">0894</span><span class="o">-</span><span class="mi">4</span><span class="n">f1e</span><span class="o">-</span><span class="n">a635</span><span class="o">-</span><span class="n">d0aeaca0e993</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">monmap</span>
</pre></div>
</div>
</li>
<li><p>Create a default data directory (or directories) on the monitor host(s).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">mon</span><span class="o">/</span><span class="p">{</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="n">hostname</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">ceph</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">mon</span><span class="o">/</span><span class="n">ceph</span><span class="o">-</span><span class="n">node1</span>
</pre></div>
</div>
<p>See <a class="reference external" href="../../rados/configuration/mon-config-ref#data">Monitor Config Reference - Data</a> for details.</p>
</li>
<li><p>Populate the monitor daemon(s) with the monitor map and keyring.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">ceph</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon</span> <span class="p">[</span><span class="o">--</span><span class="n">cluster</span> <span class="p">{</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="p">}]</span> <span class="o">--</span><span class="n">mkfs</span> <span class="o">-</span><span class="n">i</span> <span class="p">{</span><span class="n">hostname</span><span class="p">}</span> <span class="o">--</span><span class="n">monmap</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">monmap</span> <span class="o">--</span><span class="n">keyring</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">mon</span><span class="o">.</span><span class="n">keyring</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">ceph</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon</span> <span class="o">--</span><span class="n">mkfs</span> <span class="o">-</span><span class="n">i</span> <span class="n">node1</span> <span class="o">--</span><span class="n">monmap</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">monmap</span> <span class="o">--</span><span class="n">keyring</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">mon</span><span class="o">.</span><span class="n">keyring</span>
</pre></div>
</div>
</li>
<li><p>Consider settings for a Ceph configuration file. Common settings include
the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
<span class="n">fsid</span> <span class="o">=</span> <span class="p">{</span><span class="n">cluster</span><span class="o">-</span><span class="nb">id</span><span class="p">}</span>
<span class="n">mon</span> <span class="n">initial</span> <span class="n">members</span> <span class="o">=</span> <span class="p">{</span><span class="n">hostname</span><span class="p">}[,</span> <span class="p">{</span><span class="n">hostname</span><span class="p">}]</span>
<span class="n">mon</span> <span class="n">host</span> <span class="o">=</span> <span class="p">{</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="p">}[,</span> <span class="p">{</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="p">}]</span>
<span class="n">public</span> <span class="n">network</span> <span class="o">=</span> <span class="p">{</span><span class="n">network</span><span class="p">}[,</span> <span class="p">{</span><span class="n">network</span><span class="p">}]</span>
<span class="n">cluster</span> <span class="n">network</span> <span class="o">=</span> <span class="p">{</span><span class="n">network</span><span class="p">}[,</span> <span class="p">{</span><span class="n">network</span><span class="p">}]</span>
<span class="n">auth</span> <span class="n">cluster</span> <span class="n">required</span> <span class="o">=</span> <span class="n">cephx</span>
<span class="n">auth</span> <span class="n">service</span> <span class="n">required</span> <span class="o">=</span> <span class="n">cephx</span>
<span class="n">auth</span> <span class="n">client</span> <span class="n">required</span> <span class="o">=</span> <span class="n">cephx</span>
<span class="n">osd</span> <span class="n">journal</span> <span class="n">size</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="n">size</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span>  <span class="c1"># Write an object n times.</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="nb">min</span> <span class="n">size</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span> <span class="c1"># Allow writing n copies in a degraded state.</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="n">pg</span> <span class="n">num</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="n">pgp</span> <span class="n">num</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span>
<span class="n">osd</span> <span class="n">crush</span> <span class="n">chooseleaf</span> <span class="nb">type</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span>
</pre></div>
</div>
<p>In the foregoing example, the <code class="docutils literal notranslate"><span class="pre">[global]</span></code> section of the configuration might
look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
<span class="n">fsid</span> <span class="o">=</span> <span class="n">a7f64266</span><span class="o">-</span><span class="mi">0894</span><span class="o">-</span><span class="mi">4</span><span class="n">f1e</span><span class="o">-</span><span class="n">a635</span><span class="o">-</span><span class="n">d0aeaca0e993</span>
<span class="n">mon</span> <span class="n">initial</span> <span class="n">members</span> <span class="o">=</span> <span class="n">node1</span>
<span class="n">mon</span> <span class="n">host</span> <span class="o">=</span> <span class="mf">192.168.0.1</span>
<span class="n">public</span> <span class="n">network</span> <span class="o">=</span> <span class="mf">192.168.0.0</span><span class="o">/</span><span class="mi">24</span>
<span class="n">auth</span> <span class="n">cluster</span> <span class="n">required</span> <span class="o">=</span> <span class="n">cephx</span>
<span class="n">auth</span> <span class="n">service</span> <span class="n">required</span> <span class="o">=</span> <span class="n">cephx</span>
<span class="n">auth</span> <span class="n">client</span> <span class="n">required</span> <span class="o">=</span> <span class="n">cephx</span>
<span class="n">osd</span> <span class="n">journal</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="nb">min</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="n">pg</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">333</span>
<span class="n">osd</span> <span class="n">pool</span> <span class="n">default</span> <span class="n">pgp</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">333</span>
<span class="n">osd</span> <span class="n">crush</span> <span class="n">chooseleaf</span> <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>Start the monitor(s).</p>
<p>Start the service with systemd:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon</span><span class="nd">@node1</span>
</pre></div>
</div>
</li>
<li><p>Verify that the monitor is running.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>You should see output that the monitor you started is up and running, and
you should see a health error indicating that placement groups are stuck
inactive. It should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span><span class="p">:</span>
  <span class="nb">id</span><span class="p">:</span>     <span class="n">a7f64266</span><span class="o">-</span><span class="mi">0894</span><span class="o">-</span><span class="mi">4</span><span class="n">f1e</span><span class="o">-</span><span class="n">a635</span><span class="o">-</span><span class="n">d0aeaca0e993</span>
  <span class="n">health</span><span class="p">:</span> <span class="n">HEALTH_OK</span>

<span class="n">services</span><span class="p">:</span>
  <span class="n">mon</span><span class="p">:</span> <span class="mi">1</span> <span class="n">daemons</span><span class="p">,</span> <span class="n">quorum</span> <span class="n">node1</span>
  <span class="n">mgr</span><span class="p">:</span> <span class="n">node1</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
  <span class="n">osd</span><span class="p">:</span> <span class="mi">0</span> <span class="n">osds</span><span class="p">:</span> <span class="mi">0</span> <span class="n">up</span><span class="p">,</span> <span class="mi">0</span> <span class="ow">in</span>

<span class="n">data</span><span class="p">:</span>
  <span class="n">pools</span><span class="p">:</span>   <span class="mi">0</span> <span class="n">pools</span><span class="p">,</span> <span class="mi">0</span> <span class="n">pgs</span>
  <span class="n">objects</span><span class="p">:</span> <span class="mi">0</span> <span class="n">objects</span><span class="p">,</span> <span class="mi">0</span> <span class="nb">bytes</span>
  <span class="n">usage</span><span class="p">:</span>   <span class="mi">0</span> <span class="n">kB</span> <span class="n">used</span><span class="p">,</span> <span class="mi">0</span> <span class="n">kB</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">kB</span> <span class="n">avail</span>
  <span class="n">pgs</span><span class="p">:</span>
</pre></div>
</div>
<p><strong>Note:</strong> Once you add OSDs and start them, the placement group health errors
should disappear. See <a class="reference internal" href="#adding-osds">Adding OSDs</a> for details.</p>
</li>
</ol>
</section>
<section id="manager-daemon-configuration">
<h2>Manager daemon configuration<a class="headerlink" href="#manager-daemon-configuration" title="Permalink to this heading">¶</a></h2>
<p>On each node where you run a ceph-mon daemon, you should also set up a ceph-mgr daemon.</p>
<p>See <a class="reference internal" href="../../mgr/administrator/#mgr-administrator-guide"><span class="std std-ref">ceph-mgr administrator’s guide</span></a></p>
</section>
<section id="adding-osds">
<h2>Adding OSDs<a class="headerlink" href="#adding-osds" title="Permalink to this heading">¶</a></h2>
<p>Once you have your initial monitor(s) running, you should add OSDs. Your cluster
cannot reach an <code class="docutils literal notranslate"><span class="pre">active</span> <span class="pre">+</span> <span class="pre">clean</span></code> state until you have enough OSDs to handle the
number of copies of an object (e.g., <code class="docutils literal notranslate"><span class="pre">osd</span> <span class="pre">pool</span> <span class="pre">default</span> <span class="pre">size</span> <span class="pre">=</span> <span class="pre">2</span></code> requires at
least two OSDs). After bootstrapping your monitor, your cluster has a default
CRUSH map; however, the CRUSH map doesn’t have any Ceph OSD Daemons mapped to
a Ceph Node.</p>
<section id="short-form">
<h3>Short Form<a class="headerlink" href="#short-form" title="Permalink to this heading">¶</a></h3>
<p>Ceph provides the <code class="docutils literal notranslate"><span class="pre">ceph-volume</span></code> utility, which can prepare a logical volume, disk, or partition
for use with Ceph. The <code class="docutils literal notranslate"><span class="pre">ceph-volume</span></code> utility creates the OSD ID by
incrementing the index. Additionally, <code class="docutils literal notranslate"><span class="pre">ceph-volume</span></code> will add the new OSD to the
CRUSH map under the host for you. Execute <code class="docutils literal notranslate"><span class="pre">ceph-volume</span> <span class="pre">-h</span></code> for CLI details.
The <code class="docutils literal notranslate"><span class="pre">ceph-volume</span></code> utility automates the steps of the <a class="reference internal" href="#long-form">Long Form</a> below. To
create the first two OSDs with the short form procedure, execute the following
on  <code class="docutils literal notranslate"><span class="pre">node2</span></code> and <code class="docutils literal notranslate"><span class="pre">node3</span></code>:</p>
<section id="bluestore">
<h4>bluestore<a class="headerlink" href="#bluestore" title="Permalink to this heading">¶</a></h4>
<ol class="arabic">
<li><p>Create the OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="p">{</span><span class="n">node</span><span class="o">-</span><span class="n">name</span><span class="p">}</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">create</span> <span class="o">--</span><span class="n">data</span> <span class="p">{</span><span class="n">data</span><span class="o">-</span><span class="n">path</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">node1</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">create</span> <span class="o">--</span><span class="n">data</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hdd1</span>
</pre></div>
</div>
</li>
</ol>
<p>Alternatively, the creation process can be split in two phases (prepare, and
activate):</p>
<ol class="arabic">
<li><p>Prepare the OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="p">{</span><span class="n">node</span><span class="o">-</span><span class="n">name</span><span class="p">}</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">prepare</span> <span class="o">--</span><span class="n">data</span> <span class="p">{</span><span class="n">data</span><span class="o">-</span><span class="n">path</span><span class="p">}</span> <span class="p">{</span><span class="n">data</span><span class="o">-</span><span class="n">path</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">node1</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">prepare</span> <span class="o">--</span><span class="n">data</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hdd1</span>
</pre></div>
</div>
<p>Once prepared, the <code class="docutils literal notranslate"><span class="pre">ID</span></code> and <code class="docutils literal notranslate"><span class="pre">FSID</span></code> of the prepared OSD are required for
activation. These can be obtained by listing OSDs in the current server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="nb">list</span>
</pre></div>
</div>
</li>
<li><p>Activate the OSD:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">activate</span> <span class="p">{</span><span class="n">ID</span><span class="p">}</span> <span class="p">{</span><span class="n">FSID</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">activate</span> <span class="mi">0</span> <span class="n">a7f64266</span><span class="o">-</span><span class="mi">0894</span><span class="o">-</span><span class="mi">4</span><span class="n">f1e</span><span class="o">-</span><span class="n">a635</span><span class="o">-</span><span class="n">d0aeaca0e993</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="filestore">
<h4>filestore<a class="headerlink" href="#filestore" title="Permalink to this heading">¶</a></h4>
<ol class="arabic">
<li><p>Create the OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="p">{</span><span class="n">node</span><span class="o">-</span><span class="n">name</span><span class="p">}</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">create</span> <span class="o">--</span><span class="n">filestore</span> <span class="o">--</span><span class="n">data</span> <span class="p">{</span><span class="n">data</span><span class="o">-</span><span class="n">path</span><span class="p">}</span> <span class="o">--</span><span class="n">journal</span> <span class="p">{</span><span class="n">journal</span><span class="o">-</span><span class="n">path</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">node1</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">create</span> <span class="o">--</span><span class="n">filestore</span> <span class="o">--</span><span class="n">data</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hdd1</span> <span class="o">--</span><span class="n">journal</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hdd2</span>
</pre></div>
</div>
</li>
</ol>
<p>Alternatively, the creation process can be split in two phases (prepare, and
activate):</p>
<ol class="arabic">
<li><p>Prepare the OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="p">{</span><span class="n">node</span><span class="o">-</span><span class="n">name</span><span class="p">}</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">prepare</span> <span class="o">--</span><span class="n">filestore</span> <span class="o">--</span><span class="n">data</span> <span class="p">{</span><span class="n">data</span><span class="o">-</span><span class="n">path</span><span class="p">}</span> <span class="o">--</span><span class="n">journal</span> <span class="p">{</span><span class="n">journal</span><span class="o">-</span><span class="n">path</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">node1</span>
<span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">prepare</span> <span class="o">--</span><span class="n">filestore</span> <span class="o">--</span><span class="n">data</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hdd1</span> <span class="o">--</span><span class="n">journal</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hdd2</span>
</pre></div>
</div>
<p>Once prepared, the <code class="docutils literal notranslate"><span class="pre">ID</span></code> and <code class="docutils literal notranslate"><span class="pre">FSID</span></code> of the prepared OSD are required for
activation. These can be obtained by listing OSDs in the current server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="nb">list</span>
</pre></div>
</div>
</li>
<li><p>Activate the OSD:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">activate</span> <span class="o">--</span><span class="n">filestore</span> <span class="p">{</span><span class="n">ID</span><span class="p">}</span> <span class="p">{</span><span class="n">FSID</span><span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ceph</span><span class="o">-</span><span class="n">volume</span> <span class="n">lvm</span> <span class="n">activate</span> <span class="o">--</span><span class="n">filestore</span> <span class="mi">0</span> <span class="n">a7f64266</span><span class="o">-</span><span class="mi">0894</span><span class="o">-</span><span class="mi">4</span><span class="n">f1e</span><span class="o">-</span><span class="n">a635</span><span class="o">-</span><span class="n">d0aeaca0e993</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="long-form">
<h3>Long Form<a class="headerlink" href="#long-form" title="Permalink to this heading">¶</a></h3>
<p>Without the benefit of any helper utilities, create an OSD and add it to the
cluster and CRUSH map with the following procedure. To create the first two
OSDs with the long form procedure, execute the following steps for each OSD.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This procedure does not describe deployment on top of dm-crypt
making use of the dm-crypt ‘lockbox’.</p>
</div>
<ol class="arabic">
<li><p>Connect to the OSD host and become root.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="p">{</span><span class="n">node</span><span class="o">-</span><span class="n">name</span><span class="p">}</span>
<span class="n">sudo</span> <span class="n">bash</span>
</pre></div>
</div>
</li>
<li><p>Generate a UUID for the OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>UUID=$(uuidgen)
</pre></div>
</div>
</li>
<li><p>Generate a cephx key for the OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>OSD_SECRET=$(ceph-authtool --gen-print-key)
</pre></div>
</div>
</li>
<li><p>Create the OSD. Note that an OSD ID can be provided as an
additional argument to <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">new</span></code> if you need to reuse a
previously-destroyed OSD id. We assume that the
<code class="docutils literal notranslate"><span class="pre">client.bootstrap-osd</span></code> key is present on the machine.  You may
alternatively execute this command as <code class="docutils literal notranslate"><span class="pre">client.admin</span></code> on a
different host where that key is present.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ID=$(echo &quot;{\&quot;cephx_secret\&quot;: \&quot;$OSD_SECRET\&quot;}&quot; | \
   ceph osd new $UUID -i - \
   -n client.bootstrap-osd -k /var/lib/ceph/bootstrap-osd/ceph.keyring)
</pre></div>
</div>
<p>It is also possible to include a <code class="docutils literal notranslate"><span class="pre">crush_device_class</span></code> property in the JSON
to set an initial class other than the default (<code class="docutils literal notranslate"><span class="pre">ssd</span></code> or <code class="docutils literal notranslate"><span class="pre">hdd</span></code> based on
the auto-detected device type).</p>
</li>
<li><p>Create the default directory on your new OSD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir /var/lib/ceph/osd/ceph-$ID
</pre></div>
</div>
</li>
<li><p>If the OSD is for a drive other than the OS drive, prepare it
for use with Ceph, and mount it to the directory you just created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkfs.xfs /dev/{DEV}
mount /dev/{DEV} /var/lib/ceph/osd/ceph-$ID
</pre></div>
</div>
</li>
<li><p>Write the secret to the OSD keyring file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-authtool --create-keyring /var/lib/ceph/osd/ceph-$ID/keyring \
     --name osd.$ID --add-key $OSD_SECRET
</pre></div>
</div>
</li>
<li><p>Initialize the OSD data directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ceph-osd -i $ID --mkfs --osd-uuid $UUID
</pre></div>
</div>
</li>
<li><p>Fix ownership.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>chown -R ceph:ceph /var/lib/ceph/osd/ceph-$ID
</pre></div>
</div>
</li>
<li><p>After you add an OSD to Ceph, the OSD is in your configuration. However,
it is not yet running. You must start
your new OSD before it can begin receiving data.</p>
<p>For modern systemd distributions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systemctl enable ceph-osd@$ID
systemctl start ceph-osd@$ID
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">@</span><span class="mi">12</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">@</span><span class="mi">12</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="adding-mds">
<h2>Adding MDS<a class="headerlink" href="#adding-mds" title="Permalink to this heading">¶</a></h2>
<p>In the below instructions, <code class="docutils literal notranslate"><span class="pre">{id}</span></code> is an arbitrary name, such as the hostname of the machine.</p>
<ol class="arabic">
<li><p>Create the mds data directory.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">mds</span><span class="o">/</span><span class="p">{</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Create a keyring.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">--</span><span class="n">create</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">mds</span><span class="o">/</span><span class="p">{</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span><span class="o">/</span><span class="n">keyring</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span> <span class="o">-</span><span class="n">n</span> <span class="n">mds</span><span class="o">.</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Import the keyring and set caps.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">auth</span> <span class="n">add</span> <span class="n">mds</span><span class="o">.</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span> <span class="n">osd</span> <span class="s2">&quot;allow rwx&quot;</span> <span class="n">mds</span> <span class="s2">&quot;allow *&quot;</span> <span class="n">mon</span> <span class="s2">&quot;allow profile mds&quot;</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">mds</span><span class="o">/</span><span class="p">{</span><span class="n">cluster</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span><span class="o">/</span><span class="n">keyring</span>
</pre></div>
</div>
</li>
<li><p>Add to ceph.conf.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mds</span><span class="o">.</span><span class="p">{</span><span class="nb">id</span><span class="p">}]</span>
<span class="n">host</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Start the daemon the manual way.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="n">mds</span> <span class="o">--</span><span class="n">cluster</span> <span class="p">{</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="p">}</span> <span class="o">-</span><span class="n">i</span> <span class="p">{</span><span class="nb">id</span><span class="p">}</span> <span class="o">-</span><span class="n">m</span> <span class="p">{</span><span class="n">mon</span><span class="o">-</span><span class="n">hostname</span><span class="p">}:{</span><span class="n">mon</span><span class="o">-</span><span class="n">port</span><span class="p">}</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Start the daemon the right way (using ceph.conf entry).:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="n">ceph</span> <span class="n">start</span>
</pre></div>
</div>
</li>
<li><p>If starting the daemon fails with this error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mds</span><span class="o">.-</span><span class="mf">1.0</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">authenticate</span><span class="p">:</span> <span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="n">Invalid</span> <span class="n">argument</span>
</pre></div>
</div>
<p>Then make sure you do not have a keyring set in ceph.conf in the global section; move it to the client section; or add a keyring setting specific to this mds daemon. And verify that you see the same key in the mds data directory and <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">get</span> <span class="pre">mds.{id}</span></code> output.</p>
</li>
<li><p>Now you are ready to <a class="reference external" href="../../cephfs/createfs">create a Ceph file system</a>.</p></li>
</ol>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Once you have your monitor and two OSDs up and running, you can watch the
placement groups peer by executing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="o">-</span><span class="n">w</span>
</pre></div>
</div>
<p>To view the tree, execute the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">osd</span> <span class="n">tree</span>
</pre></div>
</div>
<p>You should see output that looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># id    weight  type name       up/down reweight</span>
<span class="o">-</span><span class="mi">1</span>      <span class="mi">2</span>       <span class="n">root</span> <span class="n">default</span>
<span class="o">-</span><span class="mi">2</span>      <span class="mi">2</span>               <span class="n">host</span> <span class="n">node1</span>
<span class="mi">0</span>       <span class="mi">1</span>                       <span class="n">osd</span><span class="mf">.0</span>   <span class="n">up</span>      <span class="mi">1</span>
<span class="o">-</span><span class="mi">3</span>      <span class="mi">1</span>               <span class="n">host</span> <span class="n">node2</span>
<span class="mi">1</span>       <span class="mi">1</span>                       <span class="n">osd</span><span class="mf">.1</span>   <span class="n">up</span>      <span class="mi">1</span>
</pre></div>
</div>
<p>To add (or remove) additional monitors, see <a class="reference external" href="../../rados/operations/add-or-rm-mons">Add/Remove Monitors</a>.
To add (or remove) additional Ceph OSD Daemons, see <a class="reference external" href="../../rados/operations/add-or-rm-osds">Add/Remove OSDs</a>.</p>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Installing Ceph</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../#recommended-methods">Recommended methods</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../#other-methods">Other methods</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index_manual/">Installation (Manual)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../index_manual/#get-software">Get Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index_manual/#install-software">Install Software</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index_manual/#deploy-a-cluster-manually">Deploy a Cluster Manually</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">Manual Deployment</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#monitor-bootstrapping">Monitor Bootstrapping</a></li>
<li class="toctree-l6"><a class="reference internal" href="#manager-daemon-configuration">Manager daemon configuration</a></li>
<li class="toctree-l6"><a class="reference internal" href="#adding-osds">Adding OSDs</a><ul>
<li class="toctree-l7"><a class="reference internal" href="#short-form">Short Form</a><ul>
<li class="toctree-l8"><a class="reference internal" href="#bluestore">bluestore</a></li>
<li class="toctree-l8"><a class="reference internal" href="#filestore">filestore</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="#long-form">Long Form</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="#adding-mds">Adding MDS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../manual-freebsd-deployment/">Manual Deployment on FreeBSD</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../index_manual/#upgrade-software">Upgrade Software</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#windows">Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph Storage Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../manual-freebsd-deployment/" title="Manual Deployment on FreeBSD"
             >next</a> |</li>
        <li class="right" >
          <a href="../install-vm-cloud/" title="Install Virtualization for Block Device"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Installing Ceph</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index_manual/" >Installation (Manual)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Manual Deployment</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>