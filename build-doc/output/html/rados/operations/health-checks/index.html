
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Health checks &#8212; Ceph Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/ceph.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Monitoring a Cluster" href="../monitoring/" />
    <link rel="prev" title="Operating a Cluster" href="../operating/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../monitoring/" title="Monitoring a Cluster"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../operating/" title="Operating a Cluster"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" >Ceph Storage Cluster</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../" accesskey="U">Cluster Operations</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Health checks</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div id="docubetter" align="right" style="padding: 15px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="health-checks">
<span id="id1"></span><h1>Health checks<a class="headerlink" href="#health-checks" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>There is a finite set of health messages that a Ceph cluster can raise. These
messages are known as <em>health checks</em>. Each health check has a unique
identifier.</p>
<p>The identifier is a terse human-readable string – that is, the identifier is
readable in much the same way as a typical variable name. It is intended to
enable tools (for example, UIs) to make sense of health checks and present them
in a way that reflects their meaning.</p>
<p>This page lists the health checks that are raised by the monitor and manager
daemons. In addition to these, you might see health checks that originate
from MDS daemons (see <a class="reference internal" href="../../../cephfs/health-messages/#cephfs-health-messages"><span class="std std-ref">CephFS health messages</span></a>), and health checks
that are defined by <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> python modules.</p>
</section>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this heading">¶</a></h2>
<section id="monitor">
<h3>Monitor<a class="headerlink" href="#monitor" title="Permalink to this heading">¶</a></h3>
<section id="daemon-old-version">
<h4>DAEMON_OLD_VERSION<a class="headerlink" href="#daemon-old-version" title="Permalink to this heading">¶</a></h4>
<p>Warn if one or more old versions of Ceph are running on any daemons.  A health
check is raised if multiple versions are detected.  This condition must exist
for a period of time greater than <code class="docutils literal notranslate"><span class="pre">mon_warn_older_version_delay</span></code> (set to one
week by default) in order for the health check to be raised. This allows most
upgrades to proceed without the occurrence of a false warning. If the upgrade
is paused for an extended time period, <code class="docutils literal notranslate"><span class="pre">health</span> <span class="pre">mute</span></code> can be used by running
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">health</span> <span class="pre">mute</span> <span class="pre">DAEMON_OLD_VERSION</span> <span class="pre">--sticky</span></code>. Be sure, however, to run
<code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">health</span> <span class="pre">unmute</span> <span class="pre">DAEMON_OLD_VERSION</span></code> after the upgrade has finished.</p>
</section>
<section id="mon-down">
<h4>MON_DOWN<a class="headerlink" href="#mon-down" title="Permalink to this heading">¶</a></h4>
<p>One or more monitor daemons are currently down. The cluster requires a majority
(more than one-half) of the monitors to be available. When one or more monitors
are down, clients might have a harder time forming their initial connection to
the cluster, as they might need to try more addresses before they reach an
operating monitor.</p>
<p>The down monitor daemon should be restarted as soon as possible to reduce the
risk of a subsequent monitor failure leading to a service outage.</p>
</section>
<section id="mon-clock-skew">
<h4>MON_CLOCK_SKEW<a class="headerlink" href="#mon-clock-skew" title="Permalink to this heading">¶</a></h4>
<p>The clocks on the hosts running the ceph-mon monitor daemons are not
well-synchronized. This health check is raised if the cluster detects a clock
skew greater than <code class="docutils literal notranslate"><span class="pre">mon_clock_drift_allowed</span></code>.</p>
<p>This issue is best resolved by synchronizing the clocks by using a tool like
<code class="docutils literal notranslate"><span class="pre">ntpd</span></code> or <code class="docutils literal notranslate"><span class="pre">chrony</span></code>.</p>
<p>If it is impractical to keep the clocks closely synchronized, the
<code class="docutils literal notranslate"><span class="pre">mon_clock_drift_allowed</span></code> threshold can also be increased. However, this
value must stay significantly below the <code class="docutils literal notranslate"><span class="pre">mon_lease</span></code> interval in order for the
monitor cluster to function properly.</p>
</section>
<section id="mon-msgr2-not-enabled">
<h4>MON_MSGR2_NOT_ENABLED<a class="headerlink" href="#mon-msgr2-not-enabled" title="Permalink to this heading">¶</a></h4>
<p>The <cite>ms_bind_msgr2</cite> option is enabled but one or more monitors are
not configured to bind to a v2 port in the cluster’s monmap. This
means that features specific to the msgr2 protocol (for example, encryption)
are unavailable on some or all connections.</p>
<p>In most cases this can be corrected by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">ceph<span class="w"> </span>mon<span class="w"> </span>enable-msgr2</span>
</pre></div></div><p>After this command is run, any monitor configured to listen on the old default
port (6789) will continue to listen for v1 connections on 6789 and begin to
listen for v2 connections on the new default port 3300.</p>
<p>If a monitor is configured to listen for v1 connections on a non-standard port
(that is, a port other than 6789), then the monmap will need to be modified
manually.</p>
</section>
<section id="mon-disk-low">
<h4>MON_DISK_LOW<a class="headerlink" href="#mon-disk-low" title="Permalink to this heading">¶</a></h4>
<p>One or more monitors are low on disk space. This health check is raised if the
percentage of available space on the file system used by the monitor database
(normally <code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/mon</span></code>) drops below the percentage value
<code class="docutils literal notranslate"><span class="pre">mon_data_avail_warn</span></code> (default: 30%).</p>
<p>This alert might indicate that some other process or user on the system is
filling up the file system used by the monitor. It might also
indicate that the monitor database is too large (see <code class="docutils literal notranslate"><span class="pre">MON_DISK_BIG</span></code>
below).</p>
<p>If space cannot be freed, the monitor’s data directory might need to be
moved to another storage device or file system (this relocation process must be carried out while the monitor
daemon is not running).</p>
</section>
<section id="mon-disk-crit">
<h4>MON_DISK_CRIT<a class="headerlink" href="#mon-disk-crit" title="Permalink to this heading">¶</a></h4>
<p>One or more monitors are critically low on disk space. This health check is raised if the
percentage of available space on the file system used by the monitor database
(normally <code class="docutils literal notranslate"><span class="pre">/var/lib/ceph/mon</span></code>) drops below the percentage value
<code class="docutils literal notranslate"><span class="pre">mon_data_avail_crit</span></code> (default: 5%). See <code class="docutils literal notranslate"><span class="pre">MON_DISK_LOW</span></code>, above.</p>
</section>
<section id="mon-disk-big">
<h4>MON_DISK_BIG<a class="headerlink" href="#mon-disk-big" title="Permalink to this heading">¶</a></h4>
<p>The database size for one or more monitors is very large. This health check is
raised if the size of the monitor database is larger than
<code class="docutils literal notranslate"><span class="pre">mon_data_size_warn</span></code> (default: 15 GiB).</p>
<p>A large database is unusual, but does not necessarily indicate a problem.
Monitor databases might grow in size when there are placement groups that have
not reached an <code class="docutils literal notranslate"><span class="pre">active+clean</span></code> state in a long time.</p>
<p>This alert might also indicate that the monitor’s database is not properly
compacting, an issue that has been observed with some older versions of leveldb
and rocksdb. Forcing a compaction with <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">daemon</span> <span class="pre">mon.&lt;id&gt;</span> <span class="pre">compact</span></code> might
shrink the database’s on-disk size.</p>
<p>This alert might also indicate that the monitor has a bug that prevents it from
pruning the cluster metadata that it stores. If the problem persists, please
report a bug.</p>
<p>To adjust the warning threshold, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>global<span class="w"> </span>mon_data_size_warn<span class="w"> </span>&lt;size&gt;</span>
</pre></div></div></section>
<section id="auth-insecure-global-id-reclaim">
<h4>AUTH_INSECURE_GLOBAL_ID_RECLAIM<a class="headerlink" href="#auth-insecure-global-id-reclaim" title="Permalink to this heading">¶</a></h4>
<p>One or more clients or daemons that are connected to the cluster are not
securely reclaiming their <code class="docutils literal notranslate"><span class="pre">global_id</span></code> (a unique number that identifies each
entity in the cluster) when reconnecting to a monitor. The client is being
permitted to connect anyway because the
<code class="docutils literal notranslate"><span class="pre">auth_allow_insecure_global_id_reclaim</span></code> option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> (which may
be necessary until all Ceph clients have been upgraded) and because the
<code class="docutils literal notranslate"><span class="pre">auth_expose_insecure_global_id_reclaim</span></code> option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> (which
allows monitors to detect clients with “insecure reclaim” sooner by forcing
those clients to reconnect immediately after their initial authentication).</p>
<p>To identify which client(s) are using unpatched Ceph client code, run the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>health<span class="w"> </span>detail</span>
</pre></div></div><p>If you collect a dump of the clients that are connected to an individual
monitor and examine the <code class="docutils literal notranslate"><span class="pre">global_id_status</span></code> field in the output of the dump,
you can see the <code class="docutils literal notranslate"><span class="pre">global_id</span></code> reclaim behavior of those clients. Here
<code class="docutils literal notranslate"><span class="pre">reclaim_insecure</span></code> means that a client is unpatched and is contributing to
this health check.  To effect a client dump, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>tell<span class="w"> </span>mon.<span class="se">\*</span><span class="w"> </span>sessions</span>
</pre></div></div><p>We strongly recommend that all clients in the system be upgraded to a newer
version of Ceph that correctly reclaims <code class="docutils literal notranslate"><span class="pre">global_id</span></code> values. After all clients
have been updated, run the following command to stop allowing insecure
reconnections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mon<span class="w"> </span>auth_allow_insecure_global_id_reclaim<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div><p>If it is impractical to upgrade all clients immediately, you can temporarily
silence this alert by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>health<span class="w"> </span>mute<span class="w"> </span>AUTH_INSECURE_GLOBAL_ID_RECLAIM<span class="w"> </span>1w<span class="w">   </span><span class="c1"># 1 week</span></span>
</pre></div></div><p>Although we do NOT recommend doing so, you can also disable this alert
indefinitely by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mon<span class="w"> </span>mon_warn_on_insecure_global_id_reclaim<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
<section id="auth-insecure-global-id-reclaim-allowed">
<h4>AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED<a class="headerlink" href="#auth-insecure-global-id-reclaim-allowed" title="Permalink to this heading">¶</a></h4>
<p>Ceph is currently configured to allow clients that reconnect to monitors using
an insecure process to reclaim their previous <code class="docutils literal notranslate"><span class="pre">global_id</span></code>. Such reclaiming is
allowed because, by default, <code class="docutils literal notranslate"><span class="pre">auth_allow_insecure_global_id_reclaim</span></code> is set
to <code class="docutils literal notranslate"><span class="pre">true</span></code>. It might be necessary to leave this setting enabled while existing
Ceph clients are upgraded to newer versions of Ceph that correctly and securely
reclaim their <code class="docutils literal notranslate"><span class="pre">global_id</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">AUTH_INSECURE_GLOBAL_ID_RECLAIM</span></code> health check has not also been
raised and if the <code class="docutils literal notranslate"><span class="pre">auth_expose_insecure_global_id_reclaim</span></code> setting has not
been disabled (it is enabled by default), then there are currently no clients
connected that need to be upgraded. In that case, it is safe to disable
<code class="docutils literal notranslate"><span class="pre">insecure</span> <span class="pre">global_id</span> <span class="pre">reclaim</span></code> by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mon<span class="w"> </span>auth_allow_insecure_global_id_reclaim<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div><p>On the other hand, if there are still clients that need to be upgraded, then
this alert can be temporarily silenced by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>health<span class="w"> </span>mute<span class="w"> </span>AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED<span class="w"> </span>1w<span class="w">   </span><span class="c1"># 1 week</span></span>
</pre></div></div><p>Although we do NOT recommend doing so, you can also disable this alert indefinitely
by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mon<span class="w"> </span>mon_warn_on_insecure_global_id_reclaim_allowed<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
</section>
<section id="manager">
<h3>Manager<a class="headerlink" href="#manager" title="Permalink to this heading">¶</a></h3>
<section id="mgr-down">
<h4>MGR_DOWN<a class="headerlink" href="#mgr-down" title="Permalink to this heading">¶</a></h4>
<p>All manager daemons are currently down. The cluster should normally have at
least one running manager (<code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code>) daemon. If no manager daemon is
running, the cluster’s ability to monitor itself will be compromised, and parts
of the management API will become unavailable (for example, the dashboard will
not work, and most CLI commands that report metrics or runtime state will
block). However, the cluster will still be able to perform all I/O operations
and to recover from failures.</p>
<p>The “down” manager daemon should be restarted as soon as possible to ensure
that the cluster can be monitored (for example, so that the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">-s</span></code>
information is up to date, or so that metrics can be scraped by Prometheus).</p>
</section>
<section id="mgr-module-dependency">
<h4>MGR_MODULE_DEPENDENCY<a class="headerlink" href="#mgr-module-dependency" title="Permalink to this heading">¶</a></h4>
<p>An enabled manager module is failing its dependency check. This health check
typically comes with an explanatory message from the module about the problem.</p>
<p>For example, a module might report that a required package is not installed: in
this case, you should install the required package and restart your manager
daemons.</p>
<p>This health check is applied only to enabled modules. If a module is not
enabled, you can see whether it is reporting dependency issues in the output of
<cite>ceph module ls</cite>.</p>
</section>
<section id="mgr-module-error">
<h4>MGR_MODULE_ERROR<a class="headerlink" href="#mgr-module-error" title="Permalink to this heading">¶</a></h4>
<p>A manager module has experienced an unexpected error. Typically, this means
that an unhandled exception was raised from the module’s <cite>serve</cite> function. The
human-readable description of the error might be obscurely worded if the
exception did not provide a useful description of itself.</p>
<p>This health check might indicate a bug: please open a Ceph bug report if you
think you have encountered a bug.</p>
<p>However, if you believe the error is transient, you may restart your manager
daemon(s) or use <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">mgr</span> <span class="pre">fail</span></code> on the active daemon in order to force
failover to another daemon.</p>
</section>
</section>
<section id="osds">
<h3>OSDs<a class="headerlink" href="#osds" title="Permalink to this heading">¶</a></h3>
<section id="osd-down">
<h4>OSD_DOWN<a class="headerlink" href="#osd-down" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs are marked “down”. The ceph-osd daemon might have been
stopped, or peer OSDs might be unable to reach the OSD over the network.
Common causes include a stopped or crashed daemon, a “down” host, or a network
outage.</p>
<p>Verify that the host is healthy, the daemon is started, and the network is
functioning. If the daemon has crashed, the daemon log file
(<code class="docutils literal notranslate"><span class="pre">/var/log/ceph/ceph-osd.*</span></code>) might contain debugging information.</p>
</section>
<section id="osd-crush-type-down">
<h4>OSD_&lt;crush type&gt;_DOWN<a class="headerlink" href="#osd-crush-type-down" title="Permalink to this heading">¶</a></h4>
<p>(for example, OSD_HOST_DOWN, OSD_ROOT_DOWN)</p>
<p>All of the OSDs within a particular CRUSH subtree are marked “down” (for
example, all OSDs on a host).</p>
</section>
<section id="osd-orphan">
<h4>OSD_ORPHAN<a class="headerlink" href="#osd-orphan" title="Permalink to this heading">¶</a></h4>
<p>An OSD is referenced in the CRUSH map hierarchy, but does not exist.</p>
<p>To remove the OSD from the CRUSH map hierarchy, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>crush<span class="w"> </span>rm<span class="w"> </span>osd.&lt;id&gt;</span>
</pre></div></div></section>
<section id="osd-out-of-order-full">
<h4>OSD_OUT_OF_ORDER_FULL<a class="headerlink" href="#osd-out-of-order-full" title="Permalink to this heading">¶</a></h4>
<p>The utilization thresholds for <cite>nearfull</cite>, <cite>backfillfull</cite>, <cite>full</cite>, and/or
<cite>failsafe_full</cite> are not ascending. In particular, the following pattern is
expected: <cite>nearfull &lt; backfillfull</cite>, <cite>backfillfull &lt; full</cite>, and <cite>full &lt;
failsafe_full</cite>.</p>
<p>To adjust these utilization thresholds, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-nearfull-ratio<span class="w"> </span>&lt;ratio&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-backfillfull-ratio<span class="w"> </span>&lt;ratio&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-full-ratio<span class="w"> </span>&lt;ratio&gt;</span>
</pre></div></div></section>
<section id="osd-full">
<h4>OSD_FULL<a class="headerlink" href="#osd-full" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs have exceeded the <cite>full</cite> threshold and are preventing the
cluster from servicing writes.</p>
<p>To check utilization by pool, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>df</span>
</pre></div></div><p>To see the currently defined <cite>full</cite> ratio, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>dump<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>full_ratio</span>
</pre></div></div><p>A short-term workaround to restore write availability is to raise the full
threshold by a small amount. To do so, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-full-ratio<span class="w"> </span>&lt;ratio&gt;</span>
</pre></div></div><p>Additional OSDs should be deployed in order to add new storage to the cluster,
or existing data should be deleted in order to free up space in the cluster.</p>
</section>
<section id="osd-backfillfull">
<h4>OSD_BACKFILLFULL<a class="headerlink" href="#osd-backfillfull" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs have exceeded the <cite>backfillfull</cite> threshold or <em>would</em> exceed
it if the currently-mapped backfills were to finish, which will prevent data
from rebalancing to this OSD. This alert is an early warning that
rebalancing might be unable to complete and that the cluster is approaching
full.</p>
<p>To check utilization by pool, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>df</span>
</pre></div></div></section>
<section id="osd-nearfull">
<h4>OSD_NEARFULL<a class="headerlink" href="#osd-nearfull" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs have exceeded the <cite>nearfull</cite> threshold. This alert is an early
warning that the cluster is approaching full.</p>
<p>To check utilization by pool, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>df</span>
</pre></div></div></section>
<section id="osdmap-flags">
<h4>OSDMAP_FLAGS<a class="headerlink" href="#osdmap-flags" title="Permalink to this heading">¶</a></h4>
<p>One or more cluster flags of interest have been set. These flags include:</p>
<ul class="simple">
<li><p><em>full</em> - the cluster is flagged as full and cannot serve writes</p></li>
<li><p><em>pauserd</em>, <em>pausewr</em> - there are paused reads or writes</p></li>
<li><p><em>noup</em> - OSDs are not allowed to start</p></li>
<li><p><em>nodown</em> - OSD failure reports are being ignored, and that means that the
monitors will not mark OSDs “down”</p></li>
<li><p><em>noin</em> - OSDs that were previously marked <code class="docutils literal notranslate"><span class="pre">out</span></code> are not being marked
back <code class="docutils literal notranslate"><span class="pre">in</span></code> when they start</p></li>
<li><p><em>noout</em> - “down” OSDs are not automatically being marked <code class="docutils literal notranslate"><span class="pre">out</span></code> after the
configured interval</p></li>
<li><p><em>nobackfill</em>, <em>norecover</em>, <em>norebalance</em> - recovery or data
rebalancing is suspended</p></li>
<li><p><em>noscrub</em>, <em>nodeep_scrub</em> - scrubbing is disabled</p></li>
<li><p><em>notieragent</em> - cache-tiering activity is suspended</p></li>
</ul>
<p>With the exception of <em>full</em>, these flags can be set or cleared by running the
following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;flag&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>&lt;flag&gt;</span>
</pre></div></div></section>
<section id="osd-flags">
<h4>OSD_FLAGS<a class="headerlink" href="#osd-flags" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs or CRUSH {nodes,device classes} have a flag of interest set.
These flags include:</p>
<ul class="simple">
<li><p><em>noup</em>: these OSDs are not allowed to start</p></li>
<li><p><em>nodown</em>: failure reports for these OSDs will be ignored</p></li>
<li><p><em>noin</em>: if these OSDs were previously marked <code class="docutils literal notranslate"><span class="pre">out</span></code> automatically
after a failure, they will not be marked <code class="docutils literal notranslate"><span class="pre">in</span></code> when they start</p></li>
<li><p><em>noout</em>: if these OSDs are “down” they will not automatically be marked
<code class="docutils literal notranslate"><span class="pre">out</span></code> after the configured interval</p></li>
</ul>
<p>To set and clear these flags in batch, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-group<span class="w"> </span>&lt;flags&gt;<span class="w"> </span>&lt;who&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>unset-group<span class="w"> </span>&lt;flags&gt;<span class="w"> </span>&lt;who&gt;</span>
</pre></div></div><p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-group<span class="w"> </span>noup,noout<span class="w"> </span>osd.0<span class="w"> </span>osd.1</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>unset-group<span class="w"> </span>noup,noout<span class="w"> </span>osd.0<span class="w"> </span>osd.1</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-group<span class="w"> </span>noup,noout<span class="w"> </span>host-foo</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>unset-group<span class="w"> </span>noup,noout<span class="w"> </span>host-foo</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>set-group<span class="w"> </span>noup,noout<span class="w"> </span>class-hdd</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>unset-group<span class="w"> </span>noup,noout<span class="w"> </span>class-hdd</span>
</pre></div></div></section>
<section id="old-crush-tunables">
<h4>OLD_CRUSH_TUNABLES<a class="headerlink" href="#old-crush-tunables" title="Permalink to this heading">¶</a></h4>
<p>The CRUSH map is using very old settings and should be updated. The oldest set
of tunables that can be used (that is, the oldest client version that can
connect to the cluster) without raising this health check is determined by the
<code class="docutils literal notranslate"><span class="pre">mon_crush_min_required_version</span></code> config option.  For more information, see
<a class="reference internal" href="../crush-map/#crush-map-tunables"><span class="std std-ref">Tunables</span></a>.</p>
</section>
<section id="old-crush-straw-calc-version">
<h4>OLD_CRUSH_STRAW_CALC_VERSION<a class="headerlink" href="#old-crush-straw-calc-version" title="Permalink to this heading">¶</a></h4>
<p>The CRUSH map is using an older, non-optimal method of calculating intermediate
weight values for <code class="docutils literal notranslate"><span class="pre">straw</span></code> buckets.</p>
<p>The CRUSH map should be updated to use the newer method (that is:
<code class="docutils literal notranslate"><span class="pre">straw_calc_version=1</span></code>). For more information, see <a class="reference internal" href="../crush-map/#crush-map-tunables"><span class="std std-ref">Tunables</span></a>.</p>
</section>
<section id="cache-pool-no-hit-set">
<h4>CACHE_POOL_NO_HIT_SET<a class="headerlink" href="#cache-pool-no-hit-set" title="Permalink to this heading">¶</a></h4>
<p>One or more cache pools are not configured with a <em>hit set</em> to track
utilization. This issue prevents the tiering agent from identifying cold
objects that are to be flushed and evicted from the cache.</p>
<p>To configure hit sets on the cache pool, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;poolname&gt;<span class="w"> </span>hit_set_type<span class="w"> </span>&lt;type&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;poolname&gt;<span class="w"> </span>hit_set_period<span class="w"> </span>&lt;period-in-seconds&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;poolname&gt;<span class="w"> </span>hit_set_count<span class="w"> </span>&lt;number-of-hitsets&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;poolname&gt;<span class="w"> </span>hit_set_fpp<span class="w"> </span>&lt;target-false-positive-rate&gt;</span>
</pre></div></div></section>
<section id="osd-no-sortbitwise">
<h4>OSD_NO_SORTBITWISE<a class="headerlink" href="#osd-no-sortbitwise" title="Permalink to this heading">¶</a></h4>
<p>No pre-Luminous v12.y.z OSDs are running, but the <code class="docutils literal notranslate"><span class="pre">sortbitwise</span></code> flag has not
been set.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sortbitwise</span></code> flag must be set in order for OSDs running Luminous v12.y.z
or newer to start. To safely set the flag, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span><span class="nb">set</span><span class="w"> </span>sortbitwise</span>
</pre></div></div></section>
<section id="osd-filestore">
<h4>OSD_FILESTORE<a class="headerlink" href="#osd-filestore" title="Permalink to this heading">¶</a></h4>
<p>Warn if OSDs are running Filestore. The Filestore OSD back end has been
deprecated; the BlueStore back end has been the default object store since the
Ceph Luminous release.</p>
<p>The ‘mclock_scheduler’ is not supported for Filestore OSDs. For this reason,
the default ‘osd_op_queue’ is set to ‘wpq’ for Filestore OSDs and is enforced
even if the user attempts to change it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>report<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;.&quot;osd_metadata&quot; | .[] | select(.osd_objectstore | contains(&quot;filestore&quot;)) | {id, osd_objectstore}&#39;</span></span>
</pre></div></div><p><strong>In order to upgrade to Reef or a later release, you must first migrate any
Filestore OSDs to BlueStore.</strong></p>
<p>If you are upgrading a pre-Reef release to Reef or later, but it is not
feasible to migrate Filestore OSDs to BlueStore immediately, you can
temporarily silence this alert by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>health<span class="w"> </span>mute<span class="w"> </span>OSD_FILESTORE</span>
</pre></div></div><p>Since this migration can take a considerable amount of time to complete, we
recommend that you begin the process well in advance of any update to Reef or
to later releases.</p>
</section>
<section id="pool-full">
<h4>POOL_FULL<a class="headerlink" href="#pool-full" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have reached their quota and are no longer allowing writes.</p>
<p>To see pool quotas and utilization, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>df<span class="w"> </span>detail</span>
</pre></div></div><p>If you opt to raise the pool quota, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>set-quota<span class="w"> </span>&lt;poolname&gt;<span class="w"> </span>max_objects<span class="w"> </span>&lt;num-objects&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>set-quota<span class="w"> </span>&lt;poolname&gt;<span class="w"> </span>max_bytes<span class="w"> </span>&lt;num-bytes&gt;</span>
</pre></div></div><p>If not, delete some existing data to reduce utilization.</p>
</section>
<section id="bluefs-spillover">
<h4>BLUEFS_SPILLOVER<a class="headerlink" href="#bluefs-spillover" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs that use the BlueStore back end have been allocated <cite>db</cite>
partitions (that is, storage space for metadata, normally on a faster device),
but because that space has been filled, metadata has “spilled over” onto the
slow device. This is not necessarily an error condition or even unexpected
behavior, but may result in degraded performance. If the administrator had
expected that all metadata would fit on the faster device, this alert indicates
that not enough space was provided.</p>
<p>To disable this alert on all OSDs, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>osd<span class="w"> </span>bluestore_warn_on_bluefs_spillover<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div><p>Alternatively, to disable the alert on a specific OSD, run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>osd.123<span class="w"> </span>bluestore_warn_on_bluefs_spillover<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div><p>To secure more metadata space, you can destroy and reprovision the OSD in
question. This process involves data migration and recovery.</p>
<p>It might also be possible to expand the LVM logical volume that backs the <cite>db</cite>
storage. If the underlying LV has been expanded, you must stop the OSD daemon
and inform BlueFS of the device-size change by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph-bluestore-tool<span class="w"> </span>bluefs-bdev-expand<span class="w"> </span>--path<span class="w"> </span>/var/lib/ceph/osd/ceph-<span class="nv">$ID</span></span>
</pre></div></div></section>
<section id="bluefs-available-space">
<h4>BLUEFS_AVAILABLE_SPACE<a class="headerlink" href="#bluefs-available-space" title="Permalink to this heading">¶</a></h4>
<p>To see how much space is free for BlueFS, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>daemon<span class="w"> </span>osd.123<span class="w"> </span>bluestore<span class="w"> </span>bluefs<span class="w"> </span>available</span>
</pre></div></div><p>This will output up to three values: <code class="docutils literal notranslate"><span class="pre">BDEV_DB</span> <span class="pre">free</span></code>, <code class="docutils literal notranslate"><span class="pre">BDEV_SLOW</span> <span class="pre">free</span></code>, and
<code class="docutils literal notranslate"><span class="pre">available_from_bluestore</span></code>. <code class="docutils literal notranslate"><span class="pre">BDEV_DB</span></code> and <code class="docutils literal notranslate"><span class="pre">BDEV_SLOW</span></code> report the amount
of space that has been acquired by BlueFS and is now considered free. The value
<code class="docutils literal notranslate"><span class="pre">available_from_bluestore</span></code> indicates the ability of BlueStore to relinquish
more space to BlueFS.  It is normal for this value to differ from the amount of
BlueStore free space, because the BlueFS allocation unit is typically larger
than the BlueStore allocation unit.  This means that only part of the BlueStore
free space will be available for BlueFS.</p>
</section>
<section id="bluefs-low-space">
<h4>BLUEFS_LOW_SPACE<a class="headerlink" href="#bluefs-low-space" title="Permalink to this heading">¶</a></h4>
<p>If BlueFS is running low on available free space and there is not much free
space available from BlueStore (in other words, <cite>available_from_bluestore</cite> has
a low value), consider reducing the BlueFS allocation unit size. To simulate
available space when the allocation unit is different, run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>daemon<span class="w"> </span>osd.123<span class="w"> </span>bluestore<span class="w"> </span>bluefs<span class="w"> </span>available<span class="w"> </span>&lt;alloc-unit-size&gt;</span>
</pre></div></div></section>
<section id="bluestore-fragmentation">
<h4>BLUESTORE_FRAGMENTATION<a class="headerlink" href="#bluestore-fragmentation" title="Permalink to this heading">¶</a></h4>
<p>As BlueStore operates, the free space on the underlying storage will become
fragmented.  This is normal and unavoidable, but excessive fragmentation causes
slowdown.  To inspect BlueStore fragmentation, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>daemon<span class="w"> </span>osd.123<span class="w"> </span>bluestore<span class="w"> </span>allocator<span class="w"> </span>score<span class="w"> </span>block</span>
</pre></div></div><p>The fragmentation score is given in a [0-1] range.
[0.0 .. 0.4] tiny fragmentation
[0.4 .. 0.7] small, acceptable fragmentation
[0.7 .. 0.9] considerable, but safe fragmentation
[0.9 .. 1.0] severe fragmentation, might impact BlueFS’s ability to get space from BlueStore</p>
<p>To see a detailed report of free fragments, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>daemon<span class="w"> </span>osd.123<span class="w"> </span>bluestore<span class="w"> </span>allocator<span class="w"> </span>dump<span class="w"> </span>block</span>
</pre></div></div><p>For OSD processes that are not currently running, fragmentation can be
inspected with <cite>ceph-bluestore-tool</cite>. To see the fragmentation score, run the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph-bluestore-tool<span class="w"> </span>--path<span class="w"> </span>/var/lib/ceph/osd/ceph-123<span class="w"> </span>--allocator<span class="w"> </span>block<span class="w"> </span>free-score</span>
</pre></div></div><p>To dump detailed free chunks, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph-bluestore-tool<span class="w"> </span>--path<span class="w"> </span>/var/lib/ceph/osd/ceph-123<span class="w"> </span>--allocator<span class="w"> </span>block<span class="w"> </span>free-dump</span>
</pre></div></div></section>
<section id="bluestore-legacy-statfs">
<h4>BLUESTORE_LEGACY_STATFS<a class="headerlink" href="#bluestore-legacy-statfs" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs have BlueStore volumes that were created prior to the
Nautilus release. (In Nautilus, BlueStore tracks its internal usage
statistics on a granular, per-pool basis.)</p>
<p>If <em>all</em> OSDs
are older than Nautilus, this means that the per-pool metrics are
simply unavailable. But if there is a mixture of pre-Nautilus and
post-Nautilus OSDs, the cluster usage statistics reported by <code class="docutils literal notranslate"><span class="pre">ceph</span>
<span class="pre">df</span></code> will be inaccurate.</p>
<p>The old OSDs can be updated to use the new usage-tracking scheme by stopping
each OSD, running a repair operation, and then restarting the OSD. For example,
to update <code class="docutils literal notranslate"><span class="pre">osd.123</span></code>, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>stop<span class="w"> </span>ceph-osd@123</span>
<span class="prompt1">ceph-bluestore-tool<span class="w"> </span>repair<span class="w"> </span>--path<span class="w"> </span>/var/lib/ceph/osd/ceph-123</span>
<span class="prompt1">systemctl<span class="w"> </span>start<span class="w"> </span>ceph-osd@123</span>
</pre></div></div><p>To disable this alert, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>global<span class="w"> </span>bluestore_warn_on_legacy_statfs<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
<section id="bluestore-no-per-pool-omap">
<h4>BLUESTORE_NO_PER_POOL_OMAP<a class="headerlink" href="#bluestore-no-per-pool-omap" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs have volumes that were created prior to the Octopus release.
(In Octopus and later releases, BlueStore tracks omap space utilization by
pool.)</p>
<p>If there are any BlueStore OSDs that do not have the new tracking enabled, the
cluster will report an approximate value for per-pool omap usage based on the
most recent deep scrub.</p>
<p>The OSDs can be updated to track by pool by stopping each OSD, running a repair
operation, and then restarting the OSD. For example, to update <code class="docutils literal notranslate"><span class="pre">osd.123</span></code>, run
the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>stop<span class="w"> </span>ceph-osd@123</span>
<span class="prompt1">ceph-bluestore-tool<span class="w"> </span>repair<span class="w"> </span>--path<span class="w"> </span>/var/lib/ceph/osd/ceph-123</span>
<span class="prompt1">systemctl<span class="w"> </span>start<span class="w"> </span>ceph-osd@123</span>
</pre></div></div><p>To disable this alert, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>global<span class="w"> </span>bluestore_warn_on_no_per_pool_omap<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
<section id="bluestore-no-per-pg-omap">
<h4>BLUESTORE_NO_PER_PG_OMAP<a class="headerlink" href="#bluestore-no-per-pg-omap" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs have volumes that were created prior to Pacific.  (In Pacific
and later releases Bluestore tracks omap space utilitzation by Placement Group
(PG).)</p>
<p>Per-PG omap allows faster PG removal when PGs migrate.</p>
<p>The older OSDs can be updated to track by PG by stopping each OSD, running a
repair operation, and then restarting the OSD. For example, to update
<code class="docutils literal notranslate"><span class="pre">osd.123</span></code>, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>stop<span class="w"> </span>ceph-osd@123</span>
<span class="prompt1">ceph-bluestore-tool<span class="w"> </span>repair<span class="w"> </span>--path<span class="w"> </span>/var/lib/ceph/osd/ceph-123</span>
<span class="prompt1">systemctl<span class="w"> </span>start<span class="w"> </span>ceph-osd@123</span>
</pre></div></div><p>To disable this alert, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>global<span class="w"> </span>bluestore_warn_on_no_per_pg_omap<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
<section id="bluestore-disk-size-mismatch">
<h4>BLUESTORE_DISK_SIZE_MISMATCH<a class="headerlink" href="#bluestore-disk-size-mismatch" title="Permalink to this heading">¶</a></h4>
<p>One or more BlueStore OSDs have an internal inconsistency between the size of
the physical device and the metadata that tracks its size. This inconsistency
can lead to the OSD(s) crashing in the future.</p>
<p>The OSDs that have this inconsistency should be destroyed and reprovisioned. Be
very careful to execute this procedure on only one OSD at a time, so as to
minimize the risk of losing any data. To execute this procedure, where <code class="docutils literal notranslate"><span class="pre">$N</span></code>
is the OSD that has the inconsistency, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>out<span class="w"> </span>osd.<span class="nv">$N</span></span>
<span class="prompt1"><span class="k">while</span><span class="w"> </span>!<span class="w"> </span>ceph<span class="w"> </span>osd<span class="w"> </span>safe-to-destroy<span class="w"> </span>osd.<span class="nv">$N</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>sleep<span class="w"> </span>1m<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">done</span></span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>destroy<span class="w"> </span>osd.<span class="nv">$N</span></span>
<span class="prompt1">ceph-volume<span class="w"> </span>lvm<span class="w"> </span>zap<span class="w"> </span>/path/to/device</span>
<span class="prompt1">ceph-volume<span class="w"> </span>lvm<span class="w"> </span>create<span class="w"> </span>--osd-id<span class="w"> </span><span class="nv">$N</span><span class="w"> </span>--data<span class="w"> </span>/path/to/device</span>
</pre></div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Wait for this recovery procedure to completely on one OSD before running it
on the next.</p>
</div>
</section>
<section id="bluestore-no-compression">
<h4>BLUESTORE_NO_COMPRESSION<a class="headerlink" href="#bluestore-no-compression" title="Permalink to this heading">¶</a></h4>
<p>One or more OSDs is unable to load a BlueStore compression plugin.  This issue
might be caused by a broken installation, in which the <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> binary does
not match the compression plugins. Or it might be caused by a recent upgrade in
which the <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> daemon was not restarted.</p>
<p>To resolve this issue, verify that all of the packages on the host that is
running the affected OSD(s) are correctly installed and that the OSD daemon(s)
have been restarted. If the problem persists, check the OSD log for information
about the source of the problem.</p>
</section>
<section id="bluestore-spurious-read-errors">
<h4>BLUESTORE_SPURIOUS_READ_ERRORS<a class="headerlink" href="#bluestore-spurious-read-errors" title="Permalink to this heading">¶</a></h4>
<p>One or more BlueStore OSDs detect spurious read errors on the main device.
BlueStore has recovered from these errors by retrying disk reads.  This alert
might indicate issues with underlying hardware, issues with the I/O subsystem,
or something similar.  In theory, such issues can cause permanent data
corruption.  Some observations on the root cause of spurious read errors can be
found here: <a class="reference external" href="https://tracker.ceph.com/issues/22464">https://tracker.ceph.com/issues/22464</a></p>
<p>This alert does not require an immediate response, but the affected host might
need additional attention: for example, upgrading the host to the latest
OS/kernel versions and implementing hardware-resource-utilization monitoring.</p>
<p>To disable this alert on all OSDs, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>osd<span class="w"> </span>bluestore_warn_on_spurious_read_errors<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div><p>Or, to disable this alert on a specific OSD, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>osd.123<span class="w"> </span>bluestore_warn_on_spurious_read_errors<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
</section>
<section id="device-health">
<h3>Device health<a class="headerlink" href="#device-health" title="Permalink to this heading">¶</a></h3>
<section id="id2">
<h4>DEVICE_HEALTH<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h4>
<p>One or more OSD devices are expected to fail soon, where the warning threshold
is determined by the <code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/warn_threshold</span></code> config option.</p>
<p>Because this alert applies only to OSDs that are currently marked <code class="docutils literal notranslate"><span class="pre">in</span></code>, the
appropriate response to this expected failure is (1) to mark the OSD <code class="docutils literal notranslate"><span class="pre">out</span></code> so
that data is migrated off of the OSD, and then (2) to remove the hardware from
the system. Note that this marking <code class="docutils literal notranslate"><span class="pre">out</span></code> is normally done automatically if
<code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/self_heal</span></code> is enabled (as determined by
<code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/mark_out_threshold</span></code>).</p>
<p>To check device health, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>device<span class="w"> </span>info<span class="w"> </span>&lt;device-id&gt;</span>
</pre></div></div><p>Device life expectancy is set either by a prediction model that the mgr runs or
by an external tool that is activated by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>device<span class="w"> </span>set-life-expectancy<span class="w"> </span>&lt;device-id&gt;<span class="w"> </span>&lt;from&gt;<span class="w"> </span>&lt;to&gt;</span>
</pre></div></div><p>You can change the stored life expectancy manually, but such a change usually
doesn’t accomplish anything. The reason for this is that whichever tool
originally set the stored life expectancy will probably undo your change by
setting it again, and a change to the stored value does not affect the actual
health of the hardware device.</p>
</section>
<section id="device-health-in-use">
<h4>DEVICE_HEALTH_IN_USE<a class="headerlink" href="#device-health-in-use" title="Permalink to this heading">¶</a></h4>
<p>One or more devices (that is, OSDs) are expected to fail soon and have been
marked <code class="docutils literal notranslate"><span class="pre">out</span></code> of the cluster (as controlled by
<code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/mark_out_threshold</span></code>), but they are still participating in
one or more Placement Groups. This might be because the OSD(s) were marked
<code class="docutils literal notranslate"><span class="pre">out</span></code> only recently and data is still migrating, or because data cannot be
migrated off of the OSD(s) for some reason (for example, the cluster is nearly
full, or the CRUSH hierarchy is structured so that there isn’t another suitable
OSD to migrate the data to).</p>
<p>This message can be silenced by disabling self-heal behavior (that is, setting
<code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/self_heal</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code>), by adjusting
<code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/mark_out_threshold</span></code>, or by addressing whichever condition
is preventing data from being migrated off of the ailing OSD(s).</p>
</section>
<section id="device-health-toomany">
<span id="rados-health-checks-device-health-toomany"></span><h4>DEVICE_HEALTH_TOOMANY<a class="headerlink" href="#device-health-toomany" title="Permalink to this heading">¶</a></h4>
<p>Too many devices (that is, OSDs) are expected to fail soon, and because
<code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/self_heal</span></code> behavior is enabled, marking <code class="docutils literal notranslate"><span class="pre">out</span></code> all of the
ailing OSDs would exceed the cluster’s <code class="docutils literal notranslate"><span class="pre">mon_osd_min_in_ratio</span></code> ratio.  This
ratio prevents a cascade of too many OSDs from being automatically marked
<code class="docutils literal notranslate"><span class="pre">out</span></code>.</p>
<p>You should promptly add new OSDs to the cluster to prevent data loss, or
incrementally replace the failing OSDs.</p>
<p>Alternatively, you can silence this health check by adjusting options including
<code class="docutils literal notranslate"><span class="pre">mon_osd_min_in_ratio</span></code> or <code class="docutils literal notranslate"><span class="pre">mgr/devicehealth/mark_out_threshold</span></code>.  Be
warned, however, that this will increase the likelihood of unrecoverable data
loss.</p>
</section>
</section>
<section id="data-health-pools-placement-groups">
<h3>Data health (pools &amp; placement groups)<a class="headerlink" href="#data-health-pools-placement-groups" title="Permalink to this heading">¶</a></h3>
<section id="pg-availability">
<h4>PG_AVAILABILITY<a class="headerlink" href="#pg-availability" title="Permalink to this heading">¶</a></h4>
<p>Data availability is reduced. In other words, the cluster is unable to service
potential read or write requests for at least some data in the cluster.  More
precisely, one or more Placement Groups (PGs) are in a state that does not
allow I/O requests to be serviced. Any of the following PG states are
problematic if they do not clear quickly: <em>peering</em>, <em>stale</em>, <em>incomplete</em>, and
the lack of <em>active</em>.</p>
<p>For detailed information about which PGs are affected, run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>health<span class="w"> </span>detail</span>
</pre></div></div><p>In most cases, the root cause of this issue is that one or more OSDs are
currently <code class="docutils literal notranslate"><span class="pre">down</span></code>: see <code class="docutils literal notranslate"><span class="pre">OSD_DOWN</span></code> above.</p>
<p>To see the state of a specific problematic PG, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>tell<span class="w"> </span>&lt;pgid&gt;<span class="w"> </span>query</span>
</pre></div></div></section>
<section id="pg-degraded">
<h4>PG_DEGRADED<a class="headerlink" href="#pg-degraded" title="Permalink to this heading">¶</a></h4>
<p>Data redundancy is reduced for some data: in other words, the cluster does not
have the desired number of replicas for all data (in the case of replicated
pools) or erasure code fragments (in the case of erasure-coded pools).  More
precisely, one or more Placement Groups (PGs):</p>
<ul class="simple">
<li><p>have the <em>degraded</em> or <em>undersized</em> flag set, which means that there are not
enough instances of that PG in the cluster; or</p></li>
<li><p>have not had the <em>clean</em> state set for a long time.</p></li>
</ul>
<p>For detailed information about which PGs are affected, run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>health<span class="w"> </span>detail</span>
</pre></div></div><p>In most cases, the root cause of this issue is that one or more OSDs are
currently “down”: see <code class="docutils literal notranslate"><span class="pre">OSD_DOWN</span></code> above.</p>
<p>To see the state of a specific problematic PG, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>tell<span class="w"> </span>&lt;pgid&gt;<span class="w"> </span>query</span>
</pre></div></div></section>
<section id="pg-recovery-full">
<h4>PG_RECOVERY_FULL<a class="headerlink" href="#pg-recovery-full" title="Permalink to this heading">¶</a></h4>
<p>Data redundancy might be reduced or even put at risk for some data due to a
lack of free space in the cluster. More precisely, one or more Placement Groups
have the <em>recovery_toofull</em> flag set, which means that the cluster is unable to
migrate or recover data because one or more OSDs are above the <code class="docutils literal notranslate"><span class="pre">full</span></code>
threshold.</p>
<p>For steps to resolve this condition, see <em>OSD_FULL</em> above.</p>
</section>
<section id="pg-backfill-full">
<h4>PG_BACKFILL_FULL<a class="headerlink" href="#pg-backfill-full" title="Permalink to this heading">¶</a></h4>
<p>Data redundancy might be reduced or even put at risk for some data due to a
lack of free space in the cluster. More precisely, one or more Placement Groups
have the <em>backfill_toofull</em> flag set, which means that the cluster is unable to
migrate or recover data because one or more OSDs are above the <code class="docutils literal notranslate"><span class="pre">backfillfull</span></code>
threshold.</p>
<p>For steps to resolve this condition, see <em>OSD_BACKFILLFULL</em> above.</p>
</section>
<section id="pg-damaged">
<h4>PG_DAMAGED<a class="headerlink" href="#pg-damaged" title="Permalink to this heading">¶</a></h4>
<p>Data scrubbing has discovered problems with data consistency in the cluster.
More precisely, one or more Placement Groups either (1) have the <em>inconsistent</em>
or <code class="docutils literal notranslate"><span class="pre">snaptrim_error</span></code> flag set, which indicates that an earlier data scrub
operation found a problem, or (2) have the <em>repair</em> flag set, which means that
a repair for such an inconsistency is currently in progress.</p>
<p>For more information, see <a class="reference internal" href="../pg-repair/"><span class="doc">Repairing PG Inconsistencies</span></a>.</p>
</section>
<section id="osd-scrub-errors">
<h4>OSD_SCRUB_ERRORS<a class="headerlink" href="#osd-scrub-errors" title="Permalink to this heading">¶</a></h4>
<p>Recent OSD scrubs have discovered inconsistencies. This alert is generally
paired with <em>PG_DAMAGED</em> (see above).</p>
<p>For more information, see <a class="reference internal" href="../pg-repair/"><span class="doc">Repairing PG Inconsistencies</span></a>.</p>
</section>
<section id="osd-too-many-repairs">
<h4>OSD_TOO_MANY_REPAIRS<a class="headerlink" href="#osd-too-many-repairs" title="Permalink to this heading">¶</a></h4>
<p>The count of read repairs has exceeded the config value threshold
<code class="docutils literal notranslate"><span class="pre">mon_osd_warn_num_repaired</span></code> (default: <code class="docutils literal notranslate"><span class="pre">10</span></code>).  Because scrub handles errors
only for data at rest, and because any read error that occurs when another
replica is available will be repaired immediately so that the client can get
the object data, there might exist failing disks that are not registering any
scrub errors. This repair count is maintained as a way of identifying any such
failing disks.</p>
</section>
<section id="large-omap-objects">
<h4>LARGE_OMAP_OBJECTS<a class="headerlink" href="#large-omap-objects" title="Permalink to this heading">¶</a></h4>
<p>One or more pools contain large omap objects, as determined by
<code class="docutils literal notranslate"><span class="pre">osd_deep_scrub_large_omap_object_key_threshold</span></code> (threshold for the number of
keys to determine what is considered a large omap object) or
<code class="docutils literal notranslate"><span class="pre">osd_deep_scrub_large_omap_object_value_sum_threshold</span></code> (the threshold for the
summed size in bytes of all key values to determine what is considered a large
omap object) or both.  To find more information on object name, key count, and
size in bytes, search the cluster log for ‘Large omap object found’. This issue
can be caused by RGW-bucket index objects that do not have automatic resharding
enabled. For more information on resharding, see <a class="reference internal" href="../../../radosgw/dynamicresharding/#rgw-dynamic-bucket-index-resharding"><span class="std std-ref">RGW Dynamic Bucket Index
Resharding</span></a>.</p>
<p>To adjust the thresholds mentioned above, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>osd<span class="w"> </span>osd_deep_scrub_large_omap_object_key_threshold<span class="w"> </span>&lt;keys&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>osd<span class="w"> </span>osd_deep_scrub_large_omap_object_value_sum_threshold<span class="w"> </span>&lt;bytes&gt;</span>
</pre></div></div></section>
<section id="cache-pool-near-full">
<h4>CACHE_POOL_NEAR_FULL<a class="headerlink" href="#cache-pool-near-full" title="Permalink to this heading">¶</a></h4>
<p>A cache-tier pool is nearly full, as determined by the <code class="docutils literal notranslate"><span class="pre">target_max_bytes</span></code> and
<code class="docutils literal notranslate"><span class="pre">target_max_objects</span></code> properties of the cache pool. Once the pool reaches the
target threshold, write requests to the pool might block while data is flushed
and evicted from the cache. This state normally leads to very high latencies
and poor performance.</p>
<p>To adjust the cache pool’s target size, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;cache-pool-name&gt;<span class="w"> </span>target_max_bytes<span class="w"> </span>&lt;bytes&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;cache-pool-name&gt;<span class="w"> </span>target_max_objects<span class="w"> </span>&lt;objects&gt;</span>
</pre></div></div><p>There might be other reasons that normal cache flush and evict activity are
throttled: for example, reduced availability of the base tier, reduced
performance of the base tier, or overall cluster load.</p>
</section>
<section id="too-few-pgs">
<h4>TOO_FEW_PGS<a class="headerlink" href="#too-few-pgs" title="Permalink to this heading">¶</a></h4>
<p>The number of Placement Groups (PGs) that are in use in the cluster is below
the configurable threshold of <code class="docutils literal notranslate"><span class="pre">mon_pg_warn_min_per_osd</span></code> PGs per OSD. This can
lead to suboptimal distribution and suboptimal balance of data across the OSDs
in the cluster, and a reduction of overall performance.</p>
<p>If data pools have not yet been created, this condition is expected.</p>
<p>To address this issue, you can increase the PG count for existing pools or
create new pools.  For more information, see
<a class="reference internal" href="../placement-groups/#choosing-number-of-placement-groups"><span class="std std-ref">Choosing the number of Placement Groups</span></a>.</p>
</section>
<section id="pool-pg-num-not-power-of-two">
<h4>POOL_PG_NUM_NOT_POWER_OF_TWO<a class="headerlink" href="#pool-pg-num-not-power-of-two" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have a <code class="docutils literal notranslate"><span class="pre">pg_num</span></code> value that is not a power of two.  Although
this is not strictly incorrect, it does lead to a less balanced distribution of
data because some Placement Groups will have roughly twice as much data as
others have.</p>
<p>This is easily corrected by setting the <code class="docutils literal notranslate"><span class="pre">pg_num</span></code> value for the affected
pool(s) to a nearby power of two. To do so, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_num<span class="w"> </span>&lt;value&gt;</span>
</pre></div></div><p>To disable this health check, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>global<span class="w"> </span>mon_warn_on_pool_pg_num_not_power_of_two<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
<section id="pool-too-few-pgs">
<h4>POOL_TOO_FEW_PGS<a class="headerlink" href="#pool-too-few-pgs" title="Permalink to this heading">¶</a></h4>
<p>One or more pools should probably have more Placement Groups (PGs), given the
amount of data that is currently stored in the pool. This issue can lead to
suboptimal distribution and suboptimal balance of data across the OSDs in the
cluster, and a reduction of overall performance. This alert is raised only if
the <code class="docutils literal notranslate"><span class="pre">pg_autoscale_mode</span></code> property on the pool is set to <code class="docutils literal notranslate"><span class="pre">warn</span></code>.</p>
<p>To disable the alert, entirely disable auto-scaling of PGs for the pool by
running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_autoscale_mode<span class="w"> </span>off</span>
</pre></div></div><p>To allow the cluster to automatically adjust the number of PGs for the pool,
run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_autoscale_mode<span class="w"> </span>on</span>
</pre></div></div><p>Alternatively, to manually set the number of PGs for the pool to the
recommended amount, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_num<span class="w"> </span>&lt;new-pg-num&gt;</span>
</pre></div></div><p>For more information, see <a class="reference internal" href="../placement-groups/#choosing-number-of-placement-groups"><span class="std std-ref">Choosing the number of Placement Groups</span></a> and
<a class="reference internal" href="../placement-groups/#pg-autoscaler"><span class="std std-ref">Autoscaling placement groups</span></a>.</p>
</section>
<section id="too-many-pgs">
<h4>TOO_MANY_PGS<a class="headerlink" href="#too-many-pgs" title="Permalink to this heading">¶</a></h4>
<p>The number of Placement Groups (PGs) in use in the cluster is above the
configurable threshold of <code class="docutils literal notranslate"><span class="pre">mon_max_pg_per_osd</span></code> PGs per OSD. If this threshold
is exceeded, the cluster will not allow new pools to be created, pool <cite>pg_num</cite>
to be increased, or pool replication to be increased (any of which, if allowed,
would lead to more PGs in the cluster). A large number of PGs can lead to
higher memory utilization for OSD daemons, slower peering after cluster state
changes (for example, OSD restarts, additions, or removals), and higher load on
the Manager and Monitor daemons.</p>
<p>The simplest way to mitigate the problem is to increase the number of OSDs in
the cluster by adding more hardware. Note that, because the OSD count that is
used for the purposes of this health check is the number of <code class="docutils literal notranslate"><span class="pre">in</span></code> OSDs,
marking <code class="docutils literal notranslate"><span class="pre">out</span></code> OSDs <code class="docutils literal notranslate"><span class="pre">in</span></code> (if there are any <code class="docutils literal notranslate"><span class="pre">out</span></code> OSDs available) can also
help. To do so, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;osd<span class="w"> </span>id<span class="o">(</span>s<span class="o">)</span>&gt;</span>
</pre></div></div><p>For more information, see <a class="reference internal" href="../placement-groups/#choosing-number-of-placement-groups"><span class="std std-ref">Choosing the number of Placement Groups</span></a>.</p>
</section>
<section id="pool-too-many-pgs">
<h4>POOL_TOO_MANY_PGS<a class="headerlink" href="#pool-too-many-pgs" title="Permalink to this heading">¶</a></h4>
<p>One or more pools should probably have fewer Placement Groups (PGs), given the
amount of data that is currently stored in the pool. This issue can lead to
higher memory utilization for OSD daemons, slower peering after cluster state
changes (for example, OSD restarts, additions, or removals), and higher load on
the Manager and Monitor daemons. This alert is raised only if the
<code class="docutils literal notranslate"><span class="pre">pg_autoscale_mode</span></code> property on the pool is set to <code class="docutils literal notranslate"><span class="pre">warn</span></code>.</p>
<p>To disable the alert, entirely disable auto-scaling of PGs for the pool by
running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_autoscale_mode<span class="w"> </span>off</span>
</pre></div></div><p>To allow the cluster to automatically adjust the number of PGs for the pool,
run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_autoscale_mode<span class="w"> </span>on</span>
</pre></div></div><p>Alternatively, to manually set the number of PGs for the pool to the
recommended amount, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>pg_num<span class="w"> </span>&lt;new-pg-num&gt;</span>
</pre></div></div><p>For more information, see <a class="reference internal" href="../placement-groups/#choosing-number-of-placement-groups"><span class="std std-ref">Choosing the number of Placement Groups</span></a> and
<a class="reference internal" href="../placement-groups/#pg-autoscaler"><span class="std std-ref">Autoscaling placement groups</span></a>.</p>
</section>
<section id="pool-target-size-bytes-overcommitted">
<h4>POOL_TARGET_SIZE_BYTES_OVERCOMMITTED<a class="headerlink" href="#pool-target-size-bytes-overcommitted" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have a <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> property that is set in order to
estimate the expected size of the pool, but the value(s) of this property are
greater than the total available storage (either by themselves or in
combination with other pools).</p>
<p>This alert is usually an indication that the <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> value for
the pool is too large and should be reduced or set to zero. To reduce the
<code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> value or set it to zero, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>target_size_bytes<span class="w"> </span><span class="m">0</span></span>
</pre></div></div><p>The above command sets the value of <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> to zero. To set the
value of <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> to a non-zero value, replace the <code class="docutils literal notranslate"><span class="pre">0</span></code> with that
non-zero value.</p>
<p>For more information, see <a class="reference internal" href="../placement-groups/#specifying-pool-target-size"><span class="std std-ref">Specifying expected pool size</span></a>.</p>
</section>
<section id="pool-has-target-size-bytes-and-ratio">
<h4>POOL_HAS_TARGET_SIZE_BYTES_AND_RATIO<a class="headerlink" href="#pool-has-target-size-bytes-and-ratio" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have both <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">target_size_ratio</span></code> set
in order to estimate the expected size of the pool.  Only one of these
properties should be non-zero. If both are set to a non-zero value, then
<code class="docutils literal notranslate"><span class="pre">target_size_ratio</span></code> takes precedence and <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> is ignored.</p>
<p>To reset <code class="docutils literal notranslate"><span class="pre">target_size_bytes</span></code> to zero, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool-name&gt;<span class="w"> </span>target_size_bytes<span class="w"> </span><span class="m">0</span></span>
</pre></div></div><p>For more information, see <a class="reference internal" href="../placement-groups/#specifying-pool-target-size"><span class="std std-ref">Specifying expected pool size</span></a>.</p>
</section>
<section id="too-few-osds">
<h4>TOO_FEW_OSDS<a class="headerlink" href="#too-few-osds" title="Permalink to this heading">¶</a></h4>
<p>The number of OSDs in the cluster is below the configurable threshold of
<code class="docutils literal notranslate"><span class="pre">osd_pool_default_size</span></code>. This means that some or all data may not be able to
satisfy the data protection policy specified in CRUSH rules and pool settings.</p>
</section>
<section id="smaller-pgp-num">
<h4>SMALLER_PGP_NUM<a class="headerlink" href="#smaller-pgp-num" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have a <code class="docutils literal notranslate"><span class="pre">pgp_num</span></code> value less than <code class="docutils literal notranslate"><span class="pre">pg_num</span></code>. This alert is
normally an indication that the Placement Group (PG) count was increased
without any increase in the placement behavior.</p>
<p>This disparity is sometimes brought about deliberately, in order to separate
out the <cite>split</cite> step when the PG count is adjusted from the data migration that
is needed when <code class="docutils literal notranslate"><span class="pre">pgp_num</span></code> is changed.</p>
<p>This issue is normally resolved by setting <code class="docutils literal notranslate"><span class="pre">pgp_num</span></code> to match <code class="docutils literal notranslate"><span class="pre">pg_num</span></code>, so
as to trigger the data migration, by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;pool&gt;<span class="w"> </span>pgp_num<span class="w"> </span>&lt;pg-num-value&gt;</span>
</pre></div></div></section>
<section id="many-objects-per-pg">
<h4>MANY_OBJECTS_PER_PG<a class="headerlink" href="#many-objects-per-pg" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have an average number of objects per Placement Group (PG)
that is significantly higher than the overall cluster average. The specific
threshold is determined by the <code class="docutils literal notranslate"><span class="pre">mon_pg_warn_max_object_skew</span></code> configuration
value.</p>
<p>This alert is usually an indication that the pool(s) that contain most of the
data in the cluster have too few PGs, or that other pools that contain less
data have too many PGs. See <em>TOO_MANY_PGS</em> above.</p>
<p>To silence the health check, raise the threshold by adjusting the
<code class="docutils literal notranslate"><span class="pre">mon_pg_warn_max_object_skew</span></code> config option on the managers.</p>
<p>The health check will be silenced for a specific pool only if
<code class="docutils literal notranslate"><span class="pre">pg_autoscale_mode</span></code> is set to <code class="docutils literal notranslate"><span class="pre">on</span></code>.</p>
</section>
<section id="pool-app-not-enabled">
<h4>POOL_APP_NOT_ENABLED<a class="headerlink" href="#pool-app-not-enabled" title="Permalink to this heading">¶</a></h4>
<p>A pool exists that contains one or more objects, but the pool has not been
tagged for use by a particular application.</p>
<p>To resolve this issue, tag the pool for use by an application. For
example, if the pool is used by RBD, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">rbd<span class="w"> </span>pool<span class="w"> </span>init<span class="w"> </span>&lt;poolname&gt;</span>
</pre></div></div><p>Alternatively, if the pool is being used by a custom application (here ‘foo’),
you can label the pool by running the following low-level command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>application<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>foo</span>
</pre></div></div><p>For more information, see <a class="reference internal" href="../pools/#associate-pool-to-application"><span class="std std-ref">Associate Pool to Application</span></a>.</p>
</section>
<section id="id3">
<h4>POOL_FULL<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>One or more pools have reached (or are very close to reaching) their quota. The
threshold to raise this health check is determined by the
<code class="docutils literal notranslate"><span class="pre">mon_pool_quota_crit_threshold</span></code> configuration option.</p>
<p>Pool quotas can be adjusted up or down (or removed) by running the following
commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>set-quota<span class="w"> </span>&lt;pool&gt;<span class="w"> </span>max_bytes<span class="w"> </span>&lt;bytes&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>set-quota<span class="w"> </span>&lt;pool&gt;<span class="w"> </span>max_objects<span class="w"> </span>&lt;objects&gt;</span>
</pre></div></div><p>To disable a quota, set the quota value to 0.</p>
</section>
<section id="pool-near-full">
<h4>POOL_NEAR_FULL<a class="headerlink" href="#pool-near-full" title="Permalink to this heading">¶</a></h4>
<p>One or more pools are approaching a configured fullness threshold.</p>
<p>One of the several thresholds that can raise this health check is determined by
the <code class="docutils literal notranslate"><span class="pre">mon_pool_quota_warn_threshold</span></code> configuration option.</p>
<p>Pool quotas can be adjusted up or down (or removed) by running the following
commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>set-quota<span class="w"> </span>&lt;pool&gt;<span class="w"> </span>max_bytes<span class="w"> </span>&lt;bytes&gt;</span>
<span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>pool<span class="w"> </span>set-quota<span class="w"> </span>&lt;pool&gt;<span class="w"> </span>max_objects<span class="w"> </span>&lt;objects&gt;</span>
</pre></div></div><p>To disable a quota, set the quota value to 0.</p>
<p>Other thresholds that can raise the two health checks above are
<code class="docutils literal notranslate"><span class="pre">mon_osd_nearfull_ratio</span></code> and <code class="docutils literal notranslate"><span class="pre">mon_osd_full_ratio</span></code>. For details and
resolution, see <a class="reference internal" href="../../configuration/mon-config-ref/#storage-capacity"><span class="std std-ref">Storage Capacity</span></a> and <a class="reference internal" href="../../troubleshooting/troubleshooting-osd/#no-free-drive-space"><span class="std std-ref">No Free Drive Space</span></a>.</p>
</section>
<section id="object-misplaced">
<h4>OBJECT_MISPLACED<a class="headerlink" href="#object-misplaced" title="Permalink to this heading">¶</a></h4>
<p>One or more objects in the cluster are not stored on the node that CRUSH would
prefer that they be stored on. This alert is an indication that data migration
due to a recent cluster change has not yet completed.</p>
<p>Misplaced data is not a dangerous condition in and of itself; data consistency
is never at risk, and old copies of objects will not be removed until the
desired number of new copies (in the desired locations) has been created.</p>
</section>
<section id="object-unfound">
<h4>OBJECT_UNFOUND<a class="headerlink" href="#object-unfound" title="Permalink to this heading">¶</a></h4>
<p>One or more objects in the cluster cannot be found. More precisely, the OSDs
know that a new or updated copy of an object should exist, but no such copy has
been found on OSDs that are currently online.</p>
<p>Read or write requests to unfound objects will block.</p>
<p>Ideally, a “down” OSD that has a more recent copy of the unfound object can be
brought back online. To identify candidate OSDs, check the peering state of the
PG(s) responsible for the unfound object. To see the peering state, run the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>tell<span class="w"> </span>&lt;pgid&gt;<span class="w"> </span>query</span>
</pre></div></div><p>On the other hand, if the latest copy of the object is not available, the
cluster can be told to roll back to a previous version of the object. For more
information, see <a class="reference internal" href="../../troubleshooting/troubleshooting-pg/#failures-osd-unfound"><span class="std std-ref">Unfound Objects</span></a>.</p>
</section>
<section id="slow-ops">
<h4>SLOW_OPS<a class="headerlink" href="#slow-ops" title="Permalink to this heading">¶</a></h4>
<p>One or more OSD requests or monitor requests are taking a long time to process.
This alert might be an indication of extreme load, a slow storage device, or a
software bug.</p>
<p>To query the request queue for the daemon that is causing the slowdown, run the
following command from the daemon’s host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>daemon<span class="w"> </span>osd.&lt;id&gt;<span class="w"> </span>ops</span>
</pre></div></div><p>To see a summary of the slowest recent requests, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>daemon<span class="w"> </span>osd.&lt;id&gt;<span class="w"> </span>dump_historic_ops</span>
</pre></div></div><p>To see the location of a specific OSD, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>find<span class="w"> </span>osd.&lt;id&gt;</span>
</pre></div></div></section>
<section id="pg-not-scrubbed">
<h4>PG_NOT_SCRUBBED<a class="headerlink" href="#pg-not-scrubbed" title="Permalink to this heading">¶</a></h4>
<p>One or more PGs has not been scrubbed recently.  PGs are normally scrubbed
within every configured interval specified by
<a class="reference internal" href="../../configuration/osd-config-ref/#osd-scrub-max-interval"><span class="std std-ref">osd_scrub_max_interval</span></a> globally. This
interval can be overriden on per-pool basis with
<a class="reference internal" href="../pools/#scrub-max-interval"><span class="std std-ref">scrub_max_interval</span></a>. The warning triggers when
<code class="docutils literal notranslate"><span class="pre">mon_warn_pg_not_scrubbed_ratio</span></code> percentage of interval has elapsed without a
scrub since it was due.</p>
<p>PGs will be scrubbed only if they are flagged as <code class="docutils literal notranslate"><span class="pre">clean</span></code> (which means that
they are to be cleaned, and not that they have been examined and found to be
clean). Misplaced or degraded PGs will not be flagged as <code class="docutils literal notranslate"><span class="pre">clean</span></code> (see
<em>PG_AVAILABILITY</em> and <em>PG_DEGRADED</em> above).</p>
<p>To manually initiate a scrub of a clean PG, run the following command:</p>
</section>
<section id="pg-not-deep-scrubbed">
<h4>PG_NOT_DEEP_SCRUBBED<a class="headerlink" href="#pg-not-deep-scrubbed" title="Permalink to this heading">¶</a></h4>
<p>One or more PGs has not been deep scrubbed recently.  PGs are normally
scrubbed every <code class="docutils literal notranslate"><span class="pre">osd_deep_scrub_interval</span></code> seconds, and this warning
triggers when <code class="docutils literal notranslate"><span class="pre">mon_warn_pg_not_deep_scrubbed_ratio</span></code> percentage of interval has elapsed
without a scrub since it was due.</p>
<p>PGs will receive a deep scrub only if they are flagged as <em>clean</em> (which means
that they are to be cleaned, and not that they have been examined and found to
be clean). Misplaced or degraded PGs might not be flagged as <code class="docutils literal notranslate"><span class="pre">clean</span></code> (see
<em>PG_AVAILABILITY</em> and <em>PG_DEGRADED</em> above).</p>
<p>To manually initiate a deep scrub of a clean PG, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>pg<span class="w"> </span>deep-scrub<span class="w"> </span>&lt;pgid&gt;</span>
</pre></div></div></section>
<section id="pg-slow-snap-trimming">
<h4>PG_SLOW_SNAP_TRIMMING<a class="headerlink" href="#pg-slow-snap-trimming" title="Permalink to this heading">¶</a></h4>
<p>The snapshot trim queue for one or more PGs has exceeded the configured warning
threshold. This alert indicates either that an extremely large number of
snapshots was recently deleted, or that OSDs are unable to trim snapshots
quickly enough to keep up with the rate of new snapshot deletions.</p>
<p>The warning threshold is determined by the <code class="docutils literal notranslate"><span class="pre">mon_osd_snap_trim_queue_warn_on</span></code>
option (default: 32768).</p>
<p>This alert might be raised if OSDs are under excessive load and unable to keep
up with their background work, or if the OSDs’ internal metadata database is
heavily fragmented and unable to perform. The alert might also indicate some
other performance issue with the OSDs.</p>
<p>The exact size of the snapshot trim queue is reported by the <code class="docutils literal notranslate"><span class="pre">snaptrimq_len</span></code>
field of <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">pg</span> <span class="pre">ls</span> <span class="pre">-f</span> <span class="pre">json-detail</span></code>.</p>
</section>
</section>
<section id="stretch-mode">
<h3>Stretch Mode<a class="headerlink" href="#stretch-mode" title="Permalink to this heading">¶</a></h3>
<section id="incorrect-num-buckets-stretch-mode">
<h4>INCORRECT_NUM_BUCKETS_STRETCH_MODE<a class="headerlink" href="#incorrect-num-buckets-stretch-mode" title="Permalink to this heading">¶</a></h4>
<p>Stretch mode currently only support 2 dividing buckets with OSDs, this warning suggests
that the number of dividing buckets is not equal to 2 after stretch mode is enabled.
You can expect unpredictable failures and MON assertions until the condition is fixed.</p>
<p>We encourage you to fix this by removing additional dividing buckets or bump the
number of dividing buckets to 2.</p>
</section>
<section id="uneven-weights-stretch-mode">
<h4>UNEVEN_WEIGHTS_STRETCH_MODE<a class="headerlink" href="#uneven-weights-stretch-mode" title="Permalink to this heading">¶</a></h4>
<p>The 2 dividing buckets must have equal weights when stretch mode is enabled.
This warning suggests that the 2 dividing buckets have uneven weights after
stretch mode is enabled. This is not immediately fatal, however, you can expect
Ceph to be confused when trying to process transitions between dividing buckets.</p>
<p>We encourage you to fix this by making the weights even on both dividing buckets.
This can be done by making sure the combined weight of the OSDs on each dividing
bucket are the same.</p>
</section>
</section>
<section id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this heading">¶</a></h3>
<section id="recent-crash">
<h4>RECENT_CRASH<a class="headerlink" href="#recent-crash" title="Permalink to this heading">¶</a></h4>
<p>One or more Ceph daemons have crashed recently, and the crash(es) have not yet
been acknowledged and archived by the administrator. This alert might indicate
a software bug, a hardware problem (for example, a failing disk), or some other
problem.</p>
<p>To list recent crashes, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>ls-new</span>
</pre></div></div><p>To examine information about a specific crash, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>info<span class="w"> </span>&lt;crash-id&gt;</span>
</pre></div></div><p>To silence this alert, you can archive the crash (perhaps after the crash
has been examined by an administrator) by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>archive<span class="w"> </span>&lt;crash-id&gt;</span>
</pre></div></div><p>Similarly, to archive all recent crashes, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>archive-all</span>
</pre></div></div><p>Archived crashes will still be visible by running the command <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">crash</span>
<span class="pre">ls</span></code>, but not by running the command <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">crash</span> <span class="pre">ls-new</span></code>.</p>
<p>The time period that is considered recent is determined by the option
<code class="docutils literal notranslate"><span class="pre">mgr/crash/warn_recent_interval</span></code> (default: two weeks).</p>
<p>To entirely disable this alert, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mgr/crash/warn_recent_interval<span class="w"> </span><span class="m">0</span></span>
</pre></div></div></section>
<section id="recent-mgr-module-crash">
<h4>RECENT_MGR_MODULE_CRASH<a class="headerlink" href="#recent-mgr-module-crash" title="Permalink to this heading">¶</a></h4>
<p>One or more <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> modules have crashed recently, and the crash(es) have
not yet been acknowledged and archived by the administrator.  This alert
usually indicates a software bug in one of the software modules that are
running inside the <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> daemon. The module that experienced the problem
might be disabled as a result, but other modules are unaffected and continue to
function as expected.</p>
<p>As with the <em>RECENT_CRASH</em> health check, a specific crash can be inspected by
running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>info<span class="w"> </span>&lt;crash-id&gt;</span>
</pre></div></div><p>To silence this alert, you can archive the crash (perhaps after the crash has
been examined by an administrator) by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>archive<span class="w"> </span>&lt;crash-id&gt;</span>
</pre></div></div><p>Similarly, to archive all recent crashes, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>crash<span class="w"> </span>archive-all</span>
</pre></div></div><p>Archived crashes will still be visible by running the command <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">crash</span> <span class="pre">ls</span></code>
but not by running the command <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">crash</span> <span class="pre">ls-new</span></code>.</p>
<p>The time period that is considered recent is determined by the option
<code class="docutils literal notranslate"><span class="pre">mgr/crash/warn_recent_interval</span></code> (default: two weeks).</p>
<p>To entirely disable this alert, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>mgr/crash/warn_recent_interval<span class="w"> </span><span class="m">0</span></span>
</pre></div></div></section>
<section id="telemetry-changed">
<h4>TELEMETRY_CHANGED<a class="headerlink" href="#telemetry-changed" title="Permalink to this heading">¶</a></h4>
<p>Telemetry has been enabled, but because the contents of the telemetry report
have changed in the meantime, telemetry reports will not be sent.</p>
<p>Ceph developers occasionally revise the telemetry feature to include new and
useful information, or to remove information found to be useless or sensitive.
If any new information is included in the report, Ceph requires the
administrator to re-enable telemetry. This requirement ensures that the
administrator has an opportunity to (re)review the information that will be
shared.</p>
<p>To review the contents of the telemetry report, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>telemetry<span class="w"> </span>show</span>
</pre></div></div><p>Note that the telemetry report consists of several channels that may be
independently enabled or disabled. For more information, see <a class="reference internal" href="../../../mgr/telemetry/#telemetry"><span class="std std-ref">Telemetry Module</span></a>.</p>
<p>To re-enable telemetry (and silence the alert), run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>telemetry<span class="w"> </span>on</span>
</pre></div></div><p>To disable telemetry (and silence the alert), run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>telemetry<span class="w"> </span>off</span>
</pre></div></div></section>
<section id="auth-bad-caps">
<h4>AUTH_BAD_CAPS<a class="headerlink" href="#auth-bad-caps" title="Permalink to this heading">¶</a></h4>
<p>One or more auth users have capabilities that cannot be parsed by the monitors.
As a general rule, this alert indicates that there are one or more daemon types
that the user is not authorized to use to perform any action.</p>
<p>This alert is most likely to be raised after an upgrade if (1) the capabilities
were set with an older version of Ceph that did not properly validate the
syntax of those capabilities, or if (2) the syntax of the capabilities has
changed.</p>
<p>To remove the user(s) in question, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>auth<span class="w"> </span>rm<span class="w"> </span>&lt;entity-name&gt;</span>
</pre></div></div><p>(This resolves the health check, but it prevents clients from being able to
authenticate as the removed user.)</p>
<p>Alternatively, to update the capabilities for the user(s), run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>auth<span class="w"> </span>&lt;entity-name&gt;<span class="w"> </span>&lt;daemon-type&gt;<span class="w"> </span>&lt;caps&gt;<span class="w"> </span><span class="o">[</span>&lt;daemon-type&gt;<span class="w"> </span>&lt;caps&gt;<span class="w"> </span>...<span class="o">]</span></span>
</pre></div></div><p>For more information about auth capabilities, see <a class="reference internal" href="../user-management/#user-management"><span class="std std-ref">User Management</span></a>.</p>
</section>
<section id="osd-no-down-out-interval">
<h4>OSD_NO_DOWN_OUT_INTERVAL<a class="headerlink" href="#osd-no-down-out-interval" title="Permalink to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">mon_osd_down_out_interval</span></code> option is set to zero, which means that the
system does not automatically perform any repair or healing operations when an
OSD fails. Instead, an administrator an external orchestrator must manually
mark “down” OSDs as <code class="docutils literal notranslate"><span class="pre">out</span></code> (by running <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">out</span> <span class="pre">&lt;osd-id&gt;</span></code>) in order to
trigger recovery.</p>
<p>This option is normally set to five or ten minutes, which should be enough time
for a host to power-cycle or reboot.</p>
<p>To silence this alert, set <code class="docutils literal notranslate"><span class="pre">mon_warn_on_osd_down_out_interval_zero</span></code> to
<code class="docutils literal notranslate"><span class="pre">false</span></code> by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>config<span class="w"> </span>global<span class="w"> </span>mon<span class="w"> </span>mon_warn_on_osd_down_out_interval_zero<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></section>
<section id="dashboard-debug">
<h4>DASHBOARD_DEBUG<a class="headerlink" href="#dashboard-debug" title="Permalink to this heading">¶</a></h4>
<p>The Dashboard debug mode is enabled. This means that if there is an error while
processing a REST API request, the HTTP error response will contain a Python
traceback. This mode should be disabled in production environments because such
a traceback might contain and expose sensitive information.</p>
<p>To disable the debug mode, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>dashboard<span class="w"> </span>debug<span class="w"> </span>disable</span>
</pre></div></div></section>
</section>
</section>
</section>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Intro to Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installing Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephadm/">Cephadm</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Ceph Storage Cluster</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../configuration/">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cephadm/">Deployment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Operations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../operating/">Operating a Cluster</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Health checks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definitions">Definitions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#monitor">Monitor</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#daemon-old-version">DAEMON_OLD_VERSION</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mon-down">MON_DOWN</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mon-clock-skew">MON_CLOCK_SKEW</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mon-msgr2-not-enabled">MON_MSGR2_NOT_ENABLED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mon-disk-low">MON_DISK_LOW</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mon-disk-crit">MON_DISK_CRIT</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mon-disk-big">MON_DISK_BIG</a></li>
<li class="toctree-l6"><a class="reference internal" href="#auth-insecure-global-id-reclaim">AUTH_INSECURE_GLOBAL_ID_RECLAIM</a></li>
<li class="toctree-l6"><a class="reference internal" href="#auth-insecure-global-id-reclaim-allowed">AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#manager">Manager</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#mgr-down">MGR_DOWN</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mgr-module-dependency">MGR_MODULE_DEPENDENCY</a></li>
<li class="toctree-l6"><a class="reference internal" href="#mgr-module-error">MGR_MODULE_ERROR</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#osds">OSDs</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#osd-down">OSD_DOWN</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-crush-type-down">OSD_&lt;crush type&gt;_DOWN</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-orphan">OSD_ORPHAN</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-out-of-order-full">OSD_OUT_OF_ORDER_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-full">OSD_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-backfillfull">OSD_BACKFILLFULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-nearfull">OSD_NEARFULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osdmap-flags">OSDMAP_FLAGS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-flags">OSD_FLAGS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#old-crush-tunables">OLD_CRUSH_TUNABLES</a></li>
<li class="toctree-l6"><a class="reference internal" href="#old-crush-straw-calc-version">OLD_CRUSH_STRAW_CALC_VERSION</a></li>
<li class="toctree-l6"><a class="reference internal" href="#cache-pool-no-hit-set">CACHE_POOL_NO_HIT_SET</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-no-sortbitwise">OSD_NO_SORTBITWISE</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-filestore">OSD_FILESTORE</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-full">POOL_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluefs-spillover">BLUEFS_SPILLOVER</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluefs-available-space">BLUEFS_AVAILABLE_SPACE</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluefs-low-space">BLUEFS_LOW_SPACE</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-fragmentation">BLUESTORE_FRAGMENTATION</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-legacy-statfs">BLUESTORE_LEGACY_STATFS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-no-per-pool-omap">BLUESTORE_NO_PER_POOL_OMAP</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-no-per-pg-omap">BLUESTORE_NO_PER_PG_OMAP</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-disk-size-mismatch">BLUESTORE_DISK_SIZE_MISMATCH</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-no-compression">BLUESTORE_NO_COMPRESSION</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bluestore-spurious-read-errors">BLUESTORE_SPURIOUS_READ_ERRORS</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#device-health">Device health</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#id2">DEVICE_HEALTH</a></li>
<li class="toctree-l6"><a class="reference internal" href="#device-health-in-use">DEVICE_HEALTH_IN_USE</a></li>
<li class="toctree-l6"><a class="reference internal" href="#device-health-toomany">DEVICE_HEALTH_TOOMANY</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#data-health-pools-placement-groups">Data health (pools &amp; placement groups)</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#pg-availability">PG_AVAILABILITY</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-degraded">PG_DEGRADED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-recovery-full">PG_RECOVERY_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-backfill-full">PG_BACKFILL_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-damaged">PG_DAMAGED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-scrub-errors">OSD_SCRUB_ERRORS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-too-many-repairs">OSD_TOO_MANY_REPAIRS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#large-omap-objects">LARGE_OMAP_OBJECTS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#cache-pool-near-full">CACHE_POOL_NEAR_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#too-few-pgs">TOO_FEW_PGS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-pg-num-not-power-of-two">POOL_PG_NUM_NOT_POWER_OF_TWO</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-too-few-pgs">POOL_TOO_FEW_PGS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#too-many-pgs">TOO_MANY_PGS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-too-many-pgs">POOL_TOO_MANY_PGS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-target-size-bytes-overcommitted">POOL_TARGET_SIZE_BYTES_OVERCOMMITTED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-has-target-size-bytes-and-ratio">POOL_HAS_TARGET_SIZE_BYTES_AND_RATIO</a></li>
<li class="toctree-l6"><a class="reference internal" href="#too-few-osds">TOO_FEW_OSDS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#smaller-pgp-num">SMALLER_PGP_NUM</a></li>
<li class="toctree-l6"><a class="reference internal" href="#many-objects-per-pg">MANY_OBJECTS_PER_PG</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-app-not-enabled">POOL_APP_NOT_ENABLED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id3">POOL_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pool-near-full">POOL_NEAR_FULL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#object-misplaced">OBJECT_MISPLACED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#object-unfound">OBJECT_UNFOUND</a></li>
<li class="toctree-l6"><a class="reference internal" href="#slow-ops">SLOW_OPS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-not-scrubbed">PG_NOT_SCRUBBED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-not-deep-scrubbed">PG_NOT_DEEP_SCRUBBED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#pg-slow-snap-trimming">PG_SLOW_SNAP_TRIMMING</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#stretch-mode">Stretch Mode</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#incorrect-num-buckets-stretch-mode">INCORRECT_NUM_BUCKETS_STRETCH_MODE</a></li>
<li class="toctree-l6"><a class="reference internal" href="#uneven-weights-stretch-mode">UNEVEN_WEIGHTS_STRETCH_MODE</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#miscellaneous">Miscellaneous</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#recent-crash">RECENT_CRASH</a></li>
<li class="toctree-l6"><a class="reference internal" href="#recent-mgr-module-crash">RECENT_MGR_MODULE_CRASH</a></li>
<li class="toctree-l6"><a class="reference internal" href="#telemetry-changed">TELEMETRY_CHANGED</a></li>
<li class="toctree-l6"><a class="reference internal" href="#auth-bad-caps">AUTH_BAD_CAPS</a></li>
<li class="toctree-l6"><a class="reference internal" href="#osd-no-down-out-interval">OSD_NO_DOWN_OUT_INTERVAL</a></li>
<li class="toctree-l6"><a class="reference internal" href="#dashboard-debug">DASHBOARD_DEBUG</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../monitoring/">Monitoring a Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../monitoring-osd-pg/">Monitoring OSDs and PGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user-management/">User Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pg-repair/">Repairing PG Inconsistencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data-placement/">Data Placement Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pools/">Pools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../erasure-code/">Erasure code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cache-tiering/">Cache Tiering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../placement-groups/">Placement Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../balancer/">Balancer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upmap/">Using pg-upmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crush-map/">CRUSH Maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crush-map-edits/">Manually editing a CRUSH Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stretch-mode/">Stretch Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-mon-elections/">Configure Monitor Election Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add-or-rm-osds/">Adding/Removing OSDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add-or-rm-mons/">Adding/Removing Monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devices/">Device Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bluestore-migration/">BlueStore Migration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../control/">Command Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/community/">The Ceph Community</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/troubleshooting-mon/">Troubleshooting Monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/troubleshooting-osd/">Troubleshooting OSDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/troubleshooting-pg/">Troubleshooting PGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/log-and-debug/">Logging and Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/cpu-profiling/">CPU Profiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../troubleshooting/memory-profiling/">Memory Profiling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../man/">Man Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/">APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/">Ceph Block Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph Object Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/">Ceph Manager Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mgr/dashboard/">Ceph Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/developer_guide/">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/internals/">Ceph Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../foundation/">Ceph Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/general/">Ceph Releases (general)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.ceph.com/en/latest/releases/">Ceph Releases (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../http-routingtable/" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../monitoring/" title="Monitoring a Cluster"
             >next</a> |</li>
        <li class="right" >
          <a href="../operating/" title="Operating a Cluster"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../">Ceph Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" >Ceph Storage Cluster</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../" >Cluster Operations</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Health checks</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).
    </div>
  </body>
</html>